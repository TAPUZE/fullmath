<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FormulaBox Component Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Assistant', sans-serif;
            direction: rtl;
        }
        .formula-box {
            background-color: #E5E7EB;
            padding: 0.75rem;
            border-radius: 0.375rem;
            display: inline-block;
            margin: 0.25rem;
        }
        .formula-box-block {
            background-color: #f3f4f6;
            padding: 1rem;
            border-radius: 0.375rem;
            display: block;
            margin: 0.5rem 0;
        }
    </style>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-blue-600 mb-8">בדיקת FormulaBox Component</h1>
        
        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-semibold mb-4">תוצאות מצופות מ-React FormulaBox:</h2>
            
            <div class="space-y-4">
                <p>נוסחה פשוטה: <span class="formula-box" id="formula1">$x^2 + y^2 = r^2$</span></p>
                <p>משוואה ריבועית: <span class="formula-box" id="formula2">$ax^2 + bx + c = 0$</span></p>
                <p>אינטגרל: <span class="formula-box" id="formula3">$\int_a^b f(x)dx$</span></p>
                <p>שבר: <span class="formula-box" id="formula4">$\frac{a+b}{c+d}$</span></p>
                <p>טריגונומטריה: <span class="formula-box" id="formula5">$\sin(\theta) = \frac{opposite}{hypotenuse}$</span></p>
            </div>
            
            <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                <h3 class="font-semibold text-blue-800 mb-2">מצב MathJax:</h3>
                <div id="mathjax-status" class="text-blue-700">טוען...</div>
            </div>
        </div>
        
        <div class="bg-green-50 border border-green-200 p-4 rounded-lg">
            <h3 class="font-semibold text-green-800 mb-2">לוג אירועים:</h3>
            <div id="event-log" class="text-green-700 text-sm space-y-1"></div>
        </div>
    </div>

    <script>
        // Logging function
        function logEvent(message) {
            const log = document.getElementById('event-log');
            const time = new Date().toLocaleTimeString();
            log.innerHTML += `<div>[${time}] ${message}</div>`;
            console.log(`[${time}] ${message}`);
        }

        // MathJax Configuration - Identical to React FormulaBox setup
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: { fontCache: 'global' },
            startup: {
                ready: () => {
                    logEvent('MathJax startup.ready() called');
                    window.MathJax.startup.defaultReady();
                    window.mathJaxInitialized = true;
                    document.dispatchEvent(new CustomEvent('MathJaxReady'));
                    logEvent('MathJax initialization complete, MathJaxReady event dispatched');
                    
                    // Update status
                    document.getElementById('mathjax-status').textContent = 'MathJax מוכן ופעיל!';
                }
            }
        };

        // Listen for MathJax ready event (like FormulaBox does)
        document.addEventListener('MathJaxReady', function() {
            logEvent('MathJaxReady event received');
            
            // Simulate FormulaBox behavior
            const formulas = document.querySelectorAll('.formula-box');
            formulas.forEach((formula, index) => {
                if (window.MathJax && window.MathJax.typesetPromise) {
                    window.MathJax.typesetPromise([formula])
                        .then(() => {
                            logEvent(`Formula ${index + 1} typeset successfully`);
                        })
                        .catch((err) => {
                            logEvent(`Formula ${index + 1} typesetting error: ${err}`);
                        });
                }
            });
        });

        // Check if MathJax is already initialized (FormulaBox logic)
        document.addEventListener('DOMContentLoaded', function() {
            logEvent('DOM loaded');
            if (window.mathJaxInitialized) {
                logEvent('MathJax already initialized, triggering typesetting');
                document.dispatchEvent(new CustomEvent('MathJaxReady'));
            } else {
                logEvent('MathJax not yet initialized, waiting for ready event');
            }
        });

        logEvent('Test page script loaded');
    </script>
    
    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</body>
</html>
