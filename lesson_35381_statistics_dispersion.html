<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>סטטיסטיקה (המשך) - מדדי פיזור | פלטפורמת למידה במתמטיקה</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    
    
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Assistant', sans-serif;
        }
        .formula-box {
            background-color: #E5E7EB; /* bg-gray-200 */
            padding: 0.75rem; 
            border-radius: 0.375rem; /* rounded-md */
            display: inline-block; 
            font-size: 1.125em; /* text-lg */
            line-height: 1.5; 
            margin-top: 0.25rem;
            margin-bottom: 0.25rem;
        }
        .formula-box[dir="ltr"] .math-inline { text-align: left !important; }
        #notification-box {
            transition: opacity 0.5s ease-in-out;
        }
        .solution {
            background-color: #f3f4f6; 
            border: 1px solid #d1d5db; 
        }
        .feedback.bg-green-100 { border: 1px solid #a7f3d0; }
        .feedback.bg-red-100 { border: 1px solid #fecaca; }
        .feedback.bg-yellow-100 { border: 1px solid #fde68a; }
        .math-display { text-align: center; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            margin-bottom: 1rem;
        }
        th, td {
            border: 1px solid #d1d5db; /* border-gray-300 */
            padding: 0.75rem; /* p-3 */
            text-align: center;
        }
        th {
            background-color: #f9fafb; /* bg-gray-50 */
            font-weight: 600;
        }
        footer {
            margin-top: 2rem;
            padding: 1.5rem 0;
            text-align: center;
            background-color: #f9fafb; /* bg-gray-50 */
            border-top: 1px solid #e5e7eb; /* border-gray-200 */
        }
        .navigation-buttons {
            display: inline-flex;
            justify-content: center;
            gap: 1rem;
        }
        .navigation-buttons a {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            color: #fff;
            background-color: #4f46e5; /* indigo-600 */
            border-radius: 0.375rem; /* rounded-md */
            transition: background-color 0.3s ease;
        }
        .navigation-buttons a:hover {
            background-color: #4338ca; /* indigo-700 */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

<div id="notification-box" class="fixed top-5 right-5 text-white p-4 rounded-lg shadow-xl hidden z-50 max-w-sm text-right">
הודעה תוצג כאן
</div>

<div class="container mx-auto p-4 md:p-8 max-w-5xl">
<header class="mb-8">
        <nav aria-label="breadcrumb" class="text-sm text-gray-600 mb-2">
<ol class="list-none p-0 inline-flex">
<li class="flex items-center">
<a href="index.html" class="hover:underline">דף ראשי</a>
<svg class="fill-current w-3 h-3 mx-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg>
</li>
<li class="flex items-center">
<a href="questionnaire_35381_lessons_he.html" id="breadcrumb-questionnaire" class="hover:underline">שאלון 35381</a>
           <svg class="fill-current w-3 h-3 mx-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg>
</li>
<li class="flex items-center">
<span id="breadcrumb-main-topic" class="text-gray-700">סטטיסטיקה</span>
<svg class="fill-current w-3 h-3 mx-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg>
</li>
<li class="flex items-center">
<span id="breadcrumb-lesson-name" class="text-gray-500">מדדי פיזור</span>
</li>
</ol>
</nav>
<h1 id="lesson-title" class="text-3xl md:text-4xl font-bold text-green-700">סטטיסטיקה (המשך) - מדדי פיזור</h1>
</header>

<main class="bg-white p-6 md:p-8 rounded-lg shadow-lg">

    <section id="learn" aria-labelledby="learn-heading" class="mb-12">
        <h2 id="learn-heading" class="text-2xl font-semibold text-green-600 mb-4 border-b-2 border-green-200 pb-2">לומדים 📚</h2>
        <div class="space-y-4 text-gray-700 leading-relaxed">
            <p>בשיעורים קודמים למדנו על מדדי מרכז בסטטיסטיקה, כמו ממוצע, חציון ושכיח. מדדים אלו נותנים לנו מידע על "מרכז" הנתונים, אך אינם מספרים לנו עד כמה הנתונים מפוזרים או מרוכזים סביב המרכז.</p>
            <p>לשם כך, אנו משתמשים ב<strong>מדדי פיזור</strong>. מדדי פיזור מתארים את מידת השונות או ההטרוגניות של הנתונים. ככל שמדד הפיזור גדול יותר, כך הנתונים מפוזרים יותר. ככל שהוא קטן יותר, כך הנתונים מרוכזים יותר סביב הממוצע.</p>
            
            <h3 class="text-xl font-semibold mt-6 mb-2 text-gray-800">1. טווח</h3>
            <p>הטווח הוא מדד הפיזור הפשוט ביותר. הוא מחושב כהפרש בין הערך הגבוה ביותר לערך הנמוך ביותר בקבוצת הנתונים.</p>
            <div class="my-2 text-center">
                <span class="formula-box" dir="ltr">\(\text{Range} = \text{Maximum Value} - \text{Minimum Value}\)</span>
            </div>
            <p>לדוגמה, אם ציוני תלמידים הם 70, 80, 85, 90, 100, הטווח הוא <span class="formula-box" dir="ltr">\(100 - 70 = 30\)</span>.</p>
            <p class="text-sm text-gray-600">הטווח קל לחישוב, אך הוא מושפע מאוד מערכים קיצוניים ואינו מתחשב בפיזור של שאר הנתונים.</p>

            <h3 class="text-xl font-semibold mt-6 mb-2 text-gray-800">2. שונות (Variance)</h3>
            <p>השונות היא מדד המבטא את ממוצע ריבועי הסטיות של הנתונים מהממוצע שלהם. היא מסומנת בדרך כלל ב-<span class="formula-box" dir="ltr">\(S^2\)</span> (עבור מדגם) או <span class="formula-box" dir="ltr">\(\sigma^2\)</span> (עבור אוכלוסייה).</p>
            <p>הנוסחה לחישוב השונות היא:</p>
            <div class="my-2 text-center">
                <span class="formula-box" dir="ltr">\(S^2 = \frac{\sum_{i=1}^{N} (x_i - \bar{x})^2}{N}\)</span>
            </div>
            <p>כאשר:</p>
            <ul class="list-disc pr-6 space-y-1">
                <li><span class="formula-box" dir="ltr">\(x_i\)</span> הוא כל אחד מהערכים בקבוצת הנתונים.</li>
                <li><span class="formula-box" dir="ltr">\(\bar{x}\)</span> הוא ממוצע הנתונים.</li>
                <li><span class="formula-box" dir="ltr">\(N\)</span> הוא מספר הנתונים הכולל.</li>
                <li><span class="formula-box" dir="ltr">\(\sum\)</span> מסמן סכום.</li>
            </ul>
            <p>שלבי החישוב: 1. חשב את הממוצע (<span class="formula-box" dir="ltr">\(\bar{x}\)</span>). 2. לכל נתון, חשב את סטייתו מהממוצע (<span class="formula-box" dir="ltr">\(x_i - \bar{x}\)</span>). 3. העלה כל סטייה בריבוע (<span class="formula-box" dir="ltr">\((x_i - \bar{x})^2\)</span>). 4. סכם את כל ריבועי הסטיות. 5. חלק את הסכום במספר הנתונים (<span class="formula-box" dir="ltr">\(N\)</span>).</p>

            <h3 class="text-xl font-semibold mt-6 mb-2 text-gray-800">3. סטיית תקן (Standard Deviation)</h3>
            <p>סטיית התקן היא מדד הפיזור הנפוץ והחשוב ביותר. היא מחושבת כשורש הריבועי של השונות, ומסומנת ב-<span class="formula-box" dir="ltr">\(S\)</span> או <span class="formula-box" dir="ltr">\(\sigma\)</span>.</p>
            <div class="my-2 text-center">
                <span class="formula-box" dir="ltr">\(S = \sqrt{S^2} = \sqrt{\frac{\sum_{i=1}^{N} (x_i - \bar{x})^2}{N}}\)</span>
            </div>
            <p>סטיית התקן נותנת לנו מדד לפיזור הנתונים באותן יחידות כמו הנתונים המקוריים (בניגוד לשונות, שהיא ביחידות ריבועיות). סטיית תקן גדולה מצביעה על פיזור רחב של הנתונים סביב הממוצע, בעוד שסטיית תקן קטנה מצביעה על כך שהנתונים קרובים יותר לממוצע.</p>

            <h3 class="text-xl font-semibold mt-8 mb-2 text-gray-800">דוגמה פתורה: חישוב סטיית תקן מרשימת נתונים</h3>
            <div class="border border-gray-200 rounded-lg p-4 bg-gray-50 space-y-3 mb-6">
                <p class="font-medium"><strong>דוגמה:</strong> חשב את סטיית התקן של קבוצת הציונים הבאה: 6, 7, 8, 9, 10.</p>
                <p><strong>פתרון:</strong></p>
                <p><strong>שלב 1: חישוב הממוצע (<span class="formula-box" dir="ltr">\(\bar{x}\)</span>)</strong></p>
                <div class="my-2 text-center">
                    <span class="formula-box" dir="ltr">\(\bar{x} = \frac{6+7+8+9+10}{5} = \frac{40}{5} = 8\)</span>
                </div>
                <p><strong>שלב 2: חישוב סטיות מהממוצע וריבועי הסטיות</strong></p>
                <table>
                    <thead>
                        <tr>
                            <th>ציון (<span class="formula-box" dir="ltr">\(x_i\)</span>)</th>
                            <th>סטייה מהממוצע (<span class="formula-box" dir="ltr">\(x_i - \bar{x}\)</span>)</th>
                            <th>ריבוע הסטייה (<span class="formula-box" dir="ltr">\((x_i - \bar{x})^2\)</span>)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>6</td><td><span dir="ltr">\(6-8 = -2\)</span></td><td><span dir="ltr">\((-2)^2 = 4\)</span></td></tr>
                        <tr><td>7</td><td><span dir="ltr">\(7-8 = -1\)</span></td><td><span dir="ltr">\((-1)^2 = 1\)</span></td></tr>
                        <tr><td>8</td><td><span dir="ltr">\(8-8 = 0\)</span></td><td><span dir="ltr">\((0)^2 = 0\)</span></td></tr>
                        <tr><td>9</td><td><span dir="ltr">\(9-8 = 1\)</span></td><td><span dir="ltr">\((1)^2 = 1\)</span></td></tr>
                        <tr><td>10</td><td><span dir="ltr">\(10-8 = 2\)</span></td><td><span dir="ltr">\((2)^2 = 4\)</span></td></tr>
                        <tr><td colspan="2"><strong>סכום ריבועי הסטיות (<span class="formula-box" dir="ltr">\(\sum (x_i - \bar{x})^2\)</span>)</strong></td><td><strong>10</strong></td></tr>
                    </tbody>
                </table>
                <p><strong>שלב 3: חישוב השונות (<span class="formula-box" dir="ltr">\(S^2\)</span>)</strong></p>
                <p>מספר הנתונים <span class="formula-box" dir="ltr">\(N=5\)</span>.</p>
                <div class="my-2 text-center">
                    <span class="formula-box" dir="ltr">\(S^2 = \frac{\sum (x_i - \bar{x})^2}{N} = \frac{10}{5} = 2\)</span>
                </div>
                <p><strong>שלב 4: חישוב סטיית התקן (<span class="formula-box" dir="ltr">\(S\)</span>)</strong></p>
                <div class="my-2 text-center">
                    <span class="formula-box" dir="ltr">\(S = \sqrt{S^2} = \sqrt{2} \approx 1.414\)</span>
                </div>
                <p>תשובה: סטיית התקן של הציונים היא כ-1.414.</p>
            </div>
            <p class="text-sm text-gray-600">הערה: חישוב סטיית תקן מטבלת שכיחויות דומה, אך יש להכפיל כל ריבוע סטייה בשכיחות המתאימה לפני הסכימה, ולחלק בסך כל השכיחויות (שהוא $N$).</p>
        </div>
    </section>

    <section id="practice" aria-labelledby="practice-heading" class="mb-12">
        <h2 id="practice-heading" class="text-2xl font-semibold text-green-600 mb-4 border-b-2 border-green-200 pb-2">מתרגלים ✍️</h2>
        <div class="space-y-6">
            <div class="exercise p-4 border border-gray-300 rounded-lg bg-gray-50">
                <p class="exercise-question font-medium"><strong>תרגיל 1:</strong> ציוניהם של 4 תלמידים במבחן הם: 70, 75, 85, 90. חשב את סטיית התקן של הציונים. (עגל לשתי ספרות אחרי הנקודה)</p>
                <div class="mt-3">
                    <input type="text" id="ex1-answer" class="border border-gray-300 p-2 rounded w-full md:w-1/2 focus:ring-green-500 focus:border-green-500" placeholder="הכנס סטיית תקן">
                </div>
                <div class="mt-3">
                    <button onclick="checkAnswer('ex1', '7.91', false, 0.01)" class="check-answer-btn bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-md transition duration-150 ease-in-out">בדוק תשובה</button>
                    <button onclick="showSolution('sol1')" class="show-solution-btn bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-md transition duration-150 ease-in-out ml-2">הצג פתרון</button>
                </div>
                <div id="feedback-ex1" class="feedback hidden mt-3 p-3 rounded-md text-sm"></div>
                <div id="sol1" class="solution hidden mt-3 p-3 border-t border-gray-200 bg-white rounded-md">
                    <p><strong>פתרון מלא:</strong></p>
                    <p>1. ממוצע: <span class="formula-box" dir="ltr">\(\bar{x} = \frac{70+75+85+90}{4} = \frac{320}{4} = 80\)</span>.</p>
                    <p>2. סטיות מהממוצע וריבועיהן:</p>
                    <ul class="list-disc pr-4">
                        <li><span dir="ltr">\((70-80)^2 = (-10)^2 = 100\)</span></li>
                        <li><span dir="ltr">\((75-80)^2 = (-5)^2 = 25\)</span></li>
                        <li><span dir="ltr">\((85-80)^2 = (5)^2 = 25\)</span></li>
                        <li><span dir="ltr">\((90-80)^2 = (10)^2 = 100\)</span></li>
                    </ul>
                    <p>3. סכום ריבועי הסטיות: <span class="formula-box" dir="ltr">\(100+25+25+100 = 250\)</span>.</p>
                    <p>4. שונות: <span class="formula-box" dir="ltr">\(S^2 = \frac{250}{4} = 62.5\)</span>.</p>
                    <p>5. סטיית תקן: <span class="formula-box" dir="ltr">\(S = \sqrt{62.5} \approx 7.90569\)</span>.</p>
                    <p>תשובה מעוגלת: 7.91.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="test-yourself" aria-labelledby="test-heading" class="mb-12">
        <h2 id="test-heading" class="text-2xl font-semibold text-green-600 mb-4 border-b-2 border-green-200 pb-2">בחן את עצמך 🧐</h2>
        <form id="quizForm" class="space-y-6">
            <div class="quiz-question p-4 border border-gray-300 rounded-lg bg-gray-50">
                <p class="font-medium"><strong>שאלה 1:</strong> אם כל הנתונים בקבוצה זהים (למשל, כל הציונים הם 80), מה תהיה סטיית התקן?</p>
                <div class="mt-2 space-y-1">
                    <label class="flex items-center"><input type="radio" name="q1" value="a" class="form-radio text-green-600 ml-2"> 0</label>
                    <label class="flex items-center"><input type="radio" name="q1" value="b" class="form-radio text-green-600 ml-2"> 1</label>
                    <label class="flex items-center"><input type="radio" name="q1" value="c" class="form-radio text-green-600 ml-2"> תלוי בערך הנתונים</label>
                </div>
            </div>
            <div class="quiz-question p-4 border border-gray-300 rounded-lg bg-gray-50">
                <p class="font-medium"><strong>שאלה 2:</strong> קבוצת נתונים A: (10, 20, 30). קבוצת נתונים B: (10, 15, 20, 25, 30). לאיזו קבוצה צפויה להיות סטיית תקן גדולה יותר?</p>
                 <div class="mt-2 space-y-1">
                    <label class="flex items-center"><input type="radio" name="q2" value="a" class="form-radio text-green-600 ml-2"> קבוצה A</label>
                    <label class="flex items-center"><input type="radio" name="q2" value="b" class="form-radio text-green-600 ml-2"> קבוצה B</label>
                    <label class="flex items-center"><input type="radio" name="q2" value="c" class="form-radio text-green-600 ml-2"> סטיות התקן יהיו זהות</label>
                </div>
            </div>
            <button type="button" id="submit-quiz" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md transition duration-150 ease-in-out">הגש בוחן</button>
        </form>
        <div id="quiz-results" class="hidden mt-3 p-3 rounded-md text-sm"></div>
    </section>

</main>

        <section id="progress" class="mt-8 p-6 bg-gray-50 rounded-lg shadow">
            <h3 class="text-xl font-semibold mb-4 text-gray-700">התקדמות השיעור</h3>
            <div class="flex flex-col sm:flex-row gap-3 items-center">
                <button id="markCompleted" class="w-full sm:w-auto bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-md transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-opacity-75">
                    סמן כהושלם
                </button>
                <button id="markNotCompleted" class="w-full sm:w-auto bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-2 px-4 rounded-md transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:ring-opacity-75" style="display: none;">
                    סמן כלא הושלם
                </button>
                <a id="nextLessonLink" href="#" class="w-full sm:w-auto text-center bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-md transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-75">
                    השיעור הבא &rarr;
                </a>
                <a id="lessonChoiceMenuLink" href="#" class="w-full sm:w-auto text-center bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-md transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-75">
                    &larr; חזרה לתפריט השיעורים
                </a>
            </div>
        </section>

        <footer class="bg-gray-800 text-white text-center p-6 mt-12">
            <div class="container mx-auto">
                <p class="text-sm">&copy; <span id="current-year-footer"></span> כל הזכויות שמורות. פלטפורמת למידה במתמטיקה.</p>
                <p class="text-xs mt-1">פותח בסיוע GitHub Copilot.</p>
            </div>
        </footer>
</div>

<script>
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']]
  },
  svg: { fontCache: 'global' }
};
</script>
<script type="text/javascript" id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
<script>
// Original script functions to be preserved
const QUIZ_ANSWERS = { q1: 'a', q2: 'a' }; 

function checkAnswer(exerciseId, correctAnswer, isTuple = false, tolerance = 0.001) {
    const feedbackEl = document.getElementById(`feedback-${exerciseId}`);
    const userAnswerInput = document.getElementById(`${exerciseId}-answer`);
    let userAnswerStr = userAnswerInput.value.trim();
    let isCorrect = false;

    if (isTuple) {
        userAnswerStr = userAnswerStr.replace(/\s/g, '');
        isCorrect = (userAnswerStr === correctAnswer);
    } else {
        const userAnswerNum = parseFloat(userAnswerStr);
        const correctAnswerNum = parseFloat(correctAnswer);
        if (!isNaN(userAnswerNum) && !isNaN(correctAnswerNum)) {
            isCorrect = Math.abs(userAnswerNum - correctAnswerNum) <= tolerance;
        } else { 
            isCorrect = (userAnswerStr.toLowerCase() === correctAnswer.toLowerCase());
        }
    }

    if (isCorrect) {
        feedbackEl.textContent = 'נכון מאוד! כל הכבוד! 👍';
        feedbackEl.className = 'feedback mt-3 p-3 rounded-md text-sm bg-green-100 text-green-700';
    } else {
        feedbackEl.textContent = 'תשובה שגויה. נסה שוב או הצג את הפתרון. 🤔';
        feedbackEl.className = 'feedback mt-3 p-3 rounded-md text-sm bg-red-100 text-red-700';
    }
    feedbackEl.classList.remove('hidden');
}

function showSolution(solutionId) {
    const solutionEl = document.getElementById(solutionId);
    if (solutionEl) {
        solutionEl.classList.toggle('hidden');
        if (!solutionEl.classList.contains('hidden') && typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
             MathJax.typesetPromise(solutionEl);
        } else if (!solutionEl.classList.contains('hidden') && typeof MathJax !== 'undefined' && MathJax.Hub && MathJax.Hub.Queue) {
            MathJax.Hub.Queue(["Typeset", MathJax.Hub, solutionEl]);
        }
    }
}

function recordQuizScore(score, totalQuestions) {
    if (!LESSON_ID_SUFFIX) return;
    try { 
        localStorage.setItem(`lesson_quiz_score_${LESSON_ID_SUFFIX}`, JSON.stringify({score, total: totalQuestions, date: new Date().toISOString()}));
    } catch (e) {
        console.error("Error saving quiz score to localStorage:", e);
        showNotification("שגיאה בשמירת ציון הבוחן.", "error");
    }
}

// === Standard Lesson Progress Script ===
const LESSON_ID_SUFFIX = '35381_statistics_dispersion';
const STORAGE_KEY = `lesson_completed_${LESSON_ID_SUFFIX}`;
const LESSON_CHOICE_MENU_URL = 'questionnaire_35381_lessons_he.html';
const NEXT_LESSON_URL = 'lesson_35381_probability_tree_conditional.html';

function showNotification(message, type = 'info', duration = 3000) {
    const notificationBox = document.getElementById('notification-box');
    if (!notificationBox) {
        console.warn('Notification box not found. Skipping notification:', message);
        return;
    }
    notificationBox.textContent = message;
    notificationBox.className = 'fixed top-5 right-5 text-white p-4 rounded-lg shadow-xl z-50 max-w-sm text-right'; 
    if (type === 'success') {
        notificationBox.classList.add('bg-green-500');
    } else if (type === 'error') {
        notificationBox.classList.add('bg-red-500');
    } else {
        notificationBox.classList.add('bg-blue-500');
    }
    notificationBox.classList.remove('hidden');
    notificationBox.style.opacity = 1;

    setTimeout(() => {
        notificationBox.style.opacity = 0;
        setTimeout(() => {
            notificationBox.classList.add('hidden');
        }, 500); 
    }, duration);
}

function updateButtonVisibility() {
    const markCompletedButton = document.getElementById('markCompleted');
    const markNotCompletedButton = document.getElementById('markNotCompleted');
    if (!markCompletedButton || !markNotCompletedButton) return;

    try {
        if (localStorage.getItem(STORAGE_KEY) === 'true') {
            markCompletedButton.style.display = 'none';
            markNotCompletedButton.style.display = 'inline-block';
        } else {
            markCompletedButton.style.display = 'inline-block';
            markNotCompletedButton.style.display = 'none';
        }
    } catch (e) {
        console.error('Error reading completion status from localStorage:', e);
        showNotification('שגיאה בקריאת סטטוס ההשלמה מ-localStorage.', 'error');
        markCompletedButton.style.display = 'inline-block';
        markNotCompletedButton.style.display = 'none';
    }
}

function markLessonAsCompleted() {
    try {
        localStorage.setItem(STORAGE_KEY, 'true');
        updateButtonVisibility();
        showNotification('השיעור סומן כהושלם!', 'success');
    } catch (e) {
        console.error('Error saving completion status to localStorage:', e);
        showNotification('שגיאה בשמירת סטטוס ההשלמה.', 'error');
    }
}

function markLessonAsNotCompleted() {
    try {
        localStorage.removeItem(STORAGE_KEY);
        updateButtonVisibility();
        showNotification('סטטוס הושלם בוטל.', 'info');
    } catch (e) {
        console.error('Error removing completion status from localStorage:', e);
        showNotification('שגיאה בביטול סטטוס ההשלמה.', 'error');
    }
}

document.addEventListener("DOMContentLoaded", function() {
    const currentYearSpanFooter = document.getElementById('current-year-footer');
    if (currentYearSpanFooter) {
        currentYearSpanFooter.textContent = new Date().getFullYear();
    }

    const markCompletedButton = document.getElementById('markCompleted');
    const markNotCompletedButton = document.getElementById('markNotCompleted');
    const nextLessonLink = document.getElementById('nextLessonLink');
    const lessonChoiceMenuLink = document.getElementById('lessonChoiceMenuLink');

    if (markCompletedButton) {
        markCompletedButton.addEventListener('click', markLessonAsCompleted);
    }
    if (markNotCompletedButton) {
        markNotCompletedButton.addEventListener('click', markLessonAsNotCompleted);
    }

    if (nextLessonLink) {
        nextLessonLink.href = NEXT_LESSON_URL;
    }
    if (lessonChoiceMenuLink) {
        lessonChoiceMenuLink.href = LESSON_CHOICE_MENU_URL;
    }
    
    updateButtonVisibility();

    const quizSubmitButton = document.getElementById('submit-quiz');
    if (quizSubmitButton) {
        quizSubmitButton.addEventListener('click', function() {
            let score = 0;
            const quizForm = document.getElementById('quizForm');
            const totalQuestions = Object.keys(QUIZ_ANSWERS).length;

            for (const questionKey in QUIZ_ANSWERS) {
                const userAnswer = quizForm.elements[questionKey] ? quizForm.elements[questionKey].value : null;
                if (userAnswer === QUIZ_ANSWERS[questionKey]) {
                    score++;
                }
            }
            
            const resultsEl = document.getElementById('quiz-results');
            resultsEl.textContent = `הציון שלך הוא: ${score} מתוך ${totalQuestions}.`;
            if (score === totalQuestions) resultsEl.className = 'mt-3 p-3 rounded-md text-sm bg-green-100 text-green-700';
            else if (score > 0) resultsEl.className = 'mt-3 p-3 rounded-md text-sm bg-yellow-100 text-yellow-700';
            else resultsEl.className = 'mt-3 p-3 rounded-md text-sm bg-red-100 text-red-700';
            resultsEl.classList.remove('hidden');
            
            recordQuizScore(score, totalQuestions);
            showNotification(`הבוחן הוגש! ציון: ${score}/${totalQuestions}`, 'info');
        });
    }

    // MathJax typesetting
    if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
        MathJax.typesetPromise(document.body);
    } else if (typeof MathJax !== 'undefined' && MathJax.Hub && MathJax.Hub.Queue) {
        MathJax.Hub.Queue(["Typeset", MathJax.Hub, document.body]);
    }
});
</script>
</body>
</html>

