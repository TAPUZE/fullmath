<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>גדילה ודעיכה | פלטפורמת למידה במתמטיקה</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap" rel="stylesheet">
    <script>
        // Basic MathJax Configuration
        window.MathJax = {
          tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']], // For inline math
            displayMath: [['$$', '$$'], ['\\[', '\\]']] // For display math (centered on new line)
          },
          svg: {
            fontCache: 'global' // Uses a global font cache for faster rendering
          }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
    <style>
        body {
            font-family: 'Assistant', sans-serif;
            direction: rtl; /* Ensure RTL for the whole page */
        }
        .formula-box {
            background-color: #E5E7EB; /* bg-gray-200 */
            padding: 0.75rem; 
            border-radius: 0.375rem; /* rounded-md */
            display: inline-block; 
            font-size: 1.125em; /* text-lg */
            line-height: 1.5; 
            margin-top: 0.25rem;
            margin-bottom: 0.25rem;
        }
        .formula-box[dir="ltr"] .math-inline { text-align: left !important; }
        #notification-box {
            transition: opacity 0.5s ease-in-out;
        }
        .solution {
            background-color: #f3f4f6; 
            border: 1px solid #d1d5db; 
        }
        .feedback.bg-green-100 { border: 1px solid #a7f3d0; }
        .feedback.bg-red-100 { border: 1px solid #fecaca; }
        .feedback.bg-yellow-100 { border: 1px solid #fde68a; }
        .math-display { text-align: center; }

        /* Standardized Progress Section Styles */
        #progress {
            margin-top: 30px;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 5px;
            text-align: center;
        }
        #progress button, #progress a {
            margin: 5px;
            padding: 10px 15px;
            font-size: 1em;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            text-decoration: none;
            display: inline-block; /* Ensures proper spacing and sizing */
        }
        #markCompleted {
            background-color: #28a745; /* Green */
            color: white;
        }
        #markNotCompleted {
            background-color: #dc3545; /* Red */
            color: white;
        }
        #nextLessonLink, #lessonChoiceMenuLink {
            background-color: #007bff; /* Blue */
            color: white;
        }
        .notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            border-radius: 5px;
            color: white;
            z-index: 1000;
            font-size: 1em;
        }
        .notification.success {
            background-color: #28a745;
        }
        .notification.error {
            background-color: #dc3545;
        }
        /* Standardized Footer Style */
        footer.standard-footer {
            text-align: center;
            margin-top: 30px;
            padding: 10px;
            background-color: #343a40;
            color: white;
            border-radius: 0 0 8px 8px; /* Assuming container has rounded corners */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div id="notification-box" class="fixed top-5 right-5 text-white p-4 rounded-lg shadow-xl hidden z-50 max-w-sm text-right">
        הודעה תוצג כאן
    </div>

    <div class="container mx-auto p-4 md:p-8 max-w-5xl">
        <header class="mb-8">
            <nav aria-label="breadcrumb" class="text-sm text-gray-600 mb-2">                <ol class="list-none p-0 inline-flex">
                    <li class="flex items-center">
                        <a href="index.html" class="hover:underline">דף ראשי</a>
                        <svg class="fill-current w-3 h-3 mx-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg>
                    </li>
                    <li class="flex items-center">
                        <a href="questionnaire_35381_lessons_he.html" id="breadcrumb-questionnaire" class="hover:underline">שאלון 35381</a>
                        <svg class="fill-current w-3 h-3 mx-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg>
                    </li>
                    <li class="flex items-center">
                        <span id="breadcrumb-lesson-name" class="text-gray-500">גדילה ודעיכה</span>
                    </li>
                </ol>
            </nav>
            <h1 id="lesson-title" class="text-3xl md:text-4xl font-bold text-green-700">גדילה ודעיכה</h1>
        </header>

        <main class="bg-white p-6 md:p-8 rounded-lg shadow-lg">

            <section id="learn" aria-labelledby="learn-heading" class="mb-12">
                <h2 id="learn-heading" class="text-2xl font-semibold text-green-600 mb-4 border-b-2 border-green-200 pb-2">לומדים 📚</h2>
                <div class="space-y-4 text-gray-700 leading-relaxed">
                    <p>תהליכי גדילה ודעיכה מתארים מצבים שבהם כמות מסוימת משתנה באחוז קבוע בכל תקופת זמן (למשל, כל שנה, כל שעה וכו'). דוגמאות נפוצות כוללות גידול אוכלוסייה, עליית ערך של השקעה (ריבית דריבית), ירידת ערך של מוצר (פחת), או דעיכה של חומר רדיואקטיבי.</p>
                    
                    <h3 class="text-xl font-semibold mt-6 mb-2 text-gray-800">הנוסחה המרכזית לגדילה ודעיכה</h3>
                    <p>הנוסחה לחישוב הכמות לאחר מספר תקופות זמן היא:</p>
                    <div class="my-3 text-center">
                        <span class="formula-box" dir="ltr">\(M_t = M_0 \cdot q^t\)</span>
                    </div>
                    <p>כאשר:</p>
                    <ul class="list-disc pr-6 space-y-2 my-2">
                        <li><span class="formula-box" dir="ltr">\(M_t\)</span> היא הכמות הסופית, לאחר <span class="formula-box" dir="ltr">\(t\)</span> תקופות זמן.</li>
                        <li><span class="formula-box" dir="ltr">\(M_0\)</span> היא הכמות ההתחלתית (בזמן <span class="formula-box" dir="ltr">\(t=0\)</span>).</li>
                        <li><span class="formula-box" dir="ltr">\(q\)</span> הוא גורם השינוי (גורם הגדילה או הדעיכה) בכל תקופת זמן.</li>
                        <li><span class="formula-box" dir="ltr">\(t\)</span> הוא מספר תקופות הזמן שעברו.</li>
                    </ul>

                    <h4 class="text-lg font-semibold mt-4 mb-1 text-gray-800">כיצד מחשבים את <span class="formula-box" dir="ltr">\(q\)</span>?</h4>
                    <p>אם הכמות גדלה ב-<span class="formula-box" dir="ltr">\(p\%\)</span> בכל תקופת זמן, אז גורם הגדילה הוא: <span class="formula-box" dir="ltr">\(q = 1 + \frac{p}{100}\)</span>.</p>
                    <p>לדוגמה, אם המחיר עולה ב-10% כל שנה, אז <span class="formula-box" dir="ltr">\(p=10\)</span>, ו-<span class="formula-box" dir="ltr">\(q = 1 + \frac{10}{100} = 1 + 0.1 = 1.1\)</span>.</p>
                    <p>אם הכמות קטנה (דועכת) ב-<span class="formula-box" dir="ltr">\(p\%\)</span> בכל תקופת זמן, אז גורם הדעיכה הוא: <span class="formula-box" dir="ltr">\(q = 1 - \frac{p}{100}\)</span>.</p>
                    <p>לדוגמה, אם ערך מכונית יורד ב-15% כל שנה, אז <span class="formula-box" dir="ltr">\(p=15\)</span>, ו-<span class="formula-box" dir="ltr">\(q = 1 - \frac{15}{100} = 1 - 0.15 = 0.85\)</span>.</p>
                    <p>שימו לב: אם <span class="formula-box" dir="ltr">\(q > 1\)</span> מדובר בתהליך גדילה, ואם <span class="formula-box" dir="ltr">\(0 < q < 1\)</span> מדובר בתהליך דעיכה.</p>


                    <h3 class="text-xl font-semibold mt-8 mb-2 text-gray-800">דוגמאות פתורות</h3>
                    <div class="border border-gray-200 rounded-lg p-4 bg-gray-50 space-y-3 mb-6">
                        <p class="font-medium"><strong>דוגמה 1: גידול אוכלוסייה</strong></p>
                        <p>אוכלוסיית חיידקים גדלה ב-20% בכל שעה. בתחילת הניסוי היו 1000 חיידקים. כמה חיידקים יהיו כעבור 3 שעות?</p>
                        <p><strong>פתרון:</strong></p>
                        <ul class="list-disc pr-5 space-y-1">
                            <li>הכמות ההתחלתית: <span class="formula-box" dir="ltr">\(M_0 = 1000\)</span>.</li>
                            <li>אחוז הגדילה לשעה: <span class="formula-box" dir="ltr">\(p = 20\%\)</span>.</li>
                            <li>גורם הגדילה: <span class="formula-box" dir="ltr">\(q = 1 + \frac{20}{100} = 1 + 0.2 = 1.2\)</span>.</li>
                            <li>מספר תקופות הזמן (שעות): <span class="formula-box" dir="ltr">\(t = 3\)</span>.</li>
                        </ul>
                        <p>נציב בנוסחה <span class="formula-box" dir="ltr">\(M_t = M_0 \cdot q^t\)</span>:</p>
                        <div class="my-2 text-center">
                             <span class="formula-box" dir="ltr">\(M_3 = 1000 \cdot (1.2)^3\)</span>
                        </div>
                        <div class="my-2 text-center">
                             <span class="formula-box" dir="ltr">\(M_3 = 1000 \cdot 1.728 = 1728\)</span>
                        </div>
                        <p>תשובה: כעבור 3 שעות יהיו 1728 חיידקים.</p>
                    </div>

                    <div class="border border-gray-200 rounded-lg p-4 bg-gray-50 space-y-3 mb-6">
                        <p class="font-medium"><strong>דוגמה 2: ירידת ערך (פחת)</strong></p>
                        <p>מחיר מכונית חדשה הוא 120,000 ש"ח. ערך המכונית יורד ב-10% בכל שנה. מה יהיה ערך המכונית כעבור 4 שנים?</p>
                        <p><strong>פתרון:</strong></p>
                        <ul class="list-disc pr-5 space-y-1">
                            <li>הכמות ההתחלתית (מחיר התחלתי): <span class="formula-box" dir="ltr">\(M_0 = 120,000\)</span>.</li>
                            <li>אחוז הדעיכה לשנה: <span class="formula-box" dir="ltr">\(p = 10\%\)</span>.</li>
                            <li>גורם הדעיכה: <span class="formula-box" dir="ltr">\(q = 1 - \frac{10}{100} = 1 - 0.1 = 0.9\)</span>.</li>
                            <li>מספר תקופות הזמן (שנים): <span class="formula-box" dir="ltr">\(t = 4\)</span>.</li>
                        </ul>
                        <p>נציב בנוסחה <span class="formula-box" dir="ltr">\(M_t = M_0 \cdot q^t\)</span>:</p>
                        <div class="my-2 text-center">
                             <span class="formula-box" dir="ltr">\(M_4 = 120,000 \cdot (0.9)^4\)</span>
                        </div>
                        <div class="my-2 text-center">
                             <span class="formula-box" dir="ltr">\(M_4 = 120,000 \cdot 0.6561 = 78,732\)</span>
                        </div>
                        <p>תשובה: כעבור 4 שנים, ערך המכונית יהיה 78,732 ש"ח.</p>
                    </div>
                     <div class="border border-gray-200 rounded-lg p-4 bg-gray-50 space-y-3">
                        <p class="font-medium"><strong>דוגמה 3: מציאת הכמות ההתחלתית</strong></p>
                        <p>לאחר 5 שנים, ערכו של פריט מסוים הוא 1500 ש"ח. ידוע כי ערך הפריט יורד ב-8% כל שנה. מה היה מחירו ההתחלתי של הפריט?</p>
                        <p><strong>פתרון:</strong></p>
                        <ul class="list-disc pr-5 space-y-1">
                            <li>הכמות הסופית: <span class="formula-box" dir="ltr">\(M_t = 1500\)</span> (כאשר <span class="formula-box" dir="ltr">\(t=5\)</span>).</li>
                            <li>אחוז הדעיכה לשנה: <span class="formula-box" dir="ltr">\(p = 8\%\)</span>.</li>
                            <li>גורם הדעיכה: <span class="formula-box" dir="ltr">\(q = 1 - \frac{8}{100} = 1 - 0.08 = 0.92\)</span>.</li>
                            <li>מספר תקופות הזמן (שנים): <span class="formula-box" dir="ltr">\(t = 5\)</span>.</li>
                            <li>אנחנו מחפשים את <span class="formula-box" dir="ltr">\(M_0\)</span>.</li>
                        </ul>
                        <p>נציב בנוסחה <span class="formula-box" dir="ltr">\(M_t = M_0 \cdot q^t\)</span>:</p>
                        <div class="my-2 text-center">
                             <span class="formula-box" dir="ltr">\(1500 = M_0 \cdot (0.92)^5\)</span>
                        </div>
                        <p>נחשב את <span class="formula-box" dir="ltr">\((0.92)^5 \approx 0.65908\)</span> (מומלץ להשתמש במחשבון).</p>
                        <div class="my-2 text-center">
                            <span class="formula-box" dir="ltr">\(1500 = M_0 \cdot 0.65908\)</span>
                        </div>
                        <div class="my-2 text-center">
                            <span class="formula-box" dir="ltr">\(M_0 = \frac{1500}{0.65908} \approx 2275.94\)</span>
                        </div>
                        <p>תשובה: מחירו ההתחלתי של הפריט היה כ-2275.94 ש"ח.</p>
                    </div>
                </div>
            </section>

            <section id="practice" aria-labelledby="practice-heading" class="mb-12">
                <h2 id="practice-heading" class="text-2xl font-semibold text-green-600 mb-4 border-b-2 border-green-200 pb-2">מתרגלים ✍️</h2>
                <div class="space-y-6">
                    <div class="exercise p-4 border border-gray-300 rounded-lg bg-gray-50">
                        <p class="exercise-question font-medium"><strong>תרגיל 1:</strong> סכום כסף הופקד בבנק בתוכנית חיסכון הנושאת ריבית דריבית שנתית של 5%. לאחר 6 שנים היו בתוכנית 2680.19 ש"ח. מה היה הסכום ההתחלתי שהופקד? (עגל לשתי ספרות אחרי הנקודה)</p>
                        <div class="mt-3">
                            <input type="text" id="ex1-answer" class="border border-gray-300 p-2 rounded w-full md:w-1/2 focus:ring-green-500 focus:border-green-500" placeholder="הכנס סכום התחלתי">
                        </div>
                        <div class="mt-3">
                            <button onclick="checkAnswer('ex1', '2000.00', false, 0.01)" class="check-answer-btn bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-md transition duration-150 ease-in-out">בדוק תשובה</button>
                            <button onclick="showSolution('sol1')" class="show-solution-btn bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-md transition duration-150 ease-in-out ml-2">הצג פתרון</button>
                        </div>
                        <div id="feedback-ex1" class="feedback hidden mt-3 p-3 rounded-md text-sm"></div>
                        <div id="sol1" class="solution hidden mt-3 p-3 border-t border-gray-200 bg-white rounded-md">
                            <p><strong>פתרון מלא:</strong></p>
                            <p>נתונים: <span class="formula-box" dir="ltr">\(M_t = 2680.19\)</span>, <span class="formula-box" dir="ltr">\(p = 5\%\)</span>, <span class="formula-box" dir="ltr">\(t = 6\)</span>. מחפשים <span class="formula-box" dir="ltr">\(M_0\)</span>.</p>
                            <p>גורם הגדילה: <span class="formula-box" dir="ltr">\(q = 1 + \frac{5}{100} = 1.05\)</span>.</p>
                            <p>נציב בנוסחה <span class="formula-box" dir="ltr">\(M_t = M_0 \cdot q^t\)</span>:</p>
                            <p><span class="formula-box" dir="ltr">\(2680.19 = M_0 \cdot (1.05)^6\)</span></p>
                            <p><span class="formula-box" dir="ltr">\((1.05)^6 \approx 1.3400956\)</span></p>
                            <p><span class="formula-box" dir="ltr">\(M_0 = \frac{2680.19}{1.3400956} \approx 1999.999...\)</span></p>
                            <p>תשובה: הסכום ההתחלתי היה 2000.00 ש"ח.</p>
                        </div>
                    </div>

                    <div class="exercise p-4 border border-gray-300 rounded-lg bg-gray-50">
                        <p class="exercise-question font-medium"><strong>תרגיל 2:</strong> מספר התושבים בעיר מסוימת היה 50,000 בתחילת שנת 2010. בכל שנה גדלה האוכלוסייה בעיר ב-2.5%. מה יהיה מספר התושבים בעיר בתחילת שנת 2015? (עגל למספר שלם קרוב)</p>
                        <div class="mt-3">
                            <input type="text" id="ex2-answer" class="border border-gray-300 p-2 rounded w-full md:w-1/2 focus:ring-green-500 focus:border-green-500" placeholder="הכנס מספר תושבים">
                        </div>
                        <div class="mt-3">
                            <button onclick="checkAnswer('ex2', '56570', false, 1)" class="check-answer-btn bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-md transition duration-150 ease-in-out">בדוק תשובה</button>
                            <button onclick="showSolution('sol2')" class="show-solution-btn bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-md transition duration-150 ease-in-out ml-2">הצג פתרון</button>
                        </div>
                        <div id="feedback-ex2" class="feedback hidden mt-3 p-3 rounded-md text-sm"></div>
                        <div id="sol2" class="solution hidden mt-3 p-3 border-t border-gray-200 bg-white rounded-md">
                            <p><strong>פתרון מלא:</strong></p>
                            <p>נתונים: <span class="formula-box" dir="ltr">\(M_0 = 50,000\)</span>, <span class="formula-box" dir="ltr">\(p = 2.5\%\)</span>.</p>
                            <p>מספר השנים: מתחילת 2010 עד תחילת 2015 עברו 5 שנים. לכן, <span class="formula-box" dir="ltr">\(t = 5\)</span>.</p>
                            <p>גורם הגדילה: <span class="formula-box" dir="ltr">\(q = 1 + \frac{2.5}{100} = 1.025\)</span>.</p>
                             <p>נציב בנוסחה <span class="formula-box" dir="ltr">\(M_t = M_0 \cdot q^t\)</span>:</p>
                            <p><span class="formula-box" dir="ltr">\(M_5 = 50,000 \cdot (1.025)^5\)</span></p>
                            <p><span class="formula-box" dir="ltr">\((1.025)^5 \approx 1.131408\)</span></p>
                            <p><span class="formula-box" dir="ltr">\(M_5 = 50,000 \cdot 1.131408 \approx 56570.4\)</span></p>
                            <p>תשובה: מספר התושבים יהיה כ-56,570.</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="test-yourself" aria-labelledby="test-heading" class="mb-12">
                <h2 id="test-heading" class="text-2xl font-semibold text-green-600 mb-4 border-b-2 border-green-200 pb-2">בחן את עצמך 🧐</h2>
                <form id="quizForm" class="space-y-6">
                    <div class="quiz-question p-4 border border-gray-300 rounded-lg bg-gray-50">
                        <p class="font-medium"><strong>שאלה 1:</strong> מחיר מוצר יורד בכל חודש ב-3%. מחירו ההתחלתי 500 ש"ח. מה יהיה מחירו לאחר חצי שנה (6 חודשים)? (עגל לשתי ספרות אחרי הנקודה)</p>
                        <div class="mt-2 space-y-1">
                            <label class="flex items-center"><input type="radio" name="q1" value="a" class="form-radio text-green-600 ml-2"> 416.49 ש"ח</label>
                            <label class="flex items-center"><input type="radio" name="q1" value="b" class="form-radio text-green-600 ml-2"> 410.00 ש"ח</label>
                            <label class="flex items-center"><input type="radio" name="q1" value="c" class="form-radio text-green-600 ml-2"> 425.72 ש"ח</label>
                        </div>
                    </div>
                    <div class="quiz-question p-4 border border-gray-300 rounded-lg bg-gray-50">
                        <p class="font-medium"><strong>שאלה 2:</strong> חומר רדיואקטיבי מאבד 15% ממשקלו בכל יום. אם כיום יש 200 גרם מהחומר, כמה גרם היו ממנו לפני יומיים? (עגל לשתי ספרות אחרי הנקודה)</p>
                         <div class="mt-2 space-y-1">
                            <label class="flex items-center"><input type="radio" name="q2" value="a" class="form-radio text-green-600 ml-2"> 262.83 גרם</label>
                            <label class="flex items-center"><input type="radio" name="q2" value="b" class="form-radio text-green-600 ml-2"> 276.82 גרם</label>
                            <label class="flex items-center"><input type="radio" name="q2" value="c" class="form-radio text-green-600 ml-2"> 230.00 גרם</label>
                        </div>
                    </div>
                    <button type="button" id="submit-quiz" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md transition duration-150 ease-in-out">הגש בוחן</button>
                </form>
                <div id="quiz-results" class="hidden mt-3 p-3 rounded-md text-sm"></div>
            </section>

            <!-- Standardized Progress Section -->
            <section id="progress">
                <button id="markCompleted">סמן כהושלם</button>
                <button id="markNotCompleted" style="display: none;">סמן כלא הושלם</button>
                <a id="nextLessonLink" href="#">השיעור הבא</a>
                <a id="lessonChoiceMenuLink" href="#">תפריט בחירת שיעור</a>
            </section>
        </main>

        <!-- Standardized Footer -->
        <footer class="standard-footer">
            <p>&copy; <span id="current-year-footer"></span> כל הזכויות שמורות. פותח על ידי AI.</p>
        </footer>
    </div>

    <script>
        const LESSON_ID_SUFFIX = '35381_growth_decay';
        const STORAGE_KEY = `lesson_completed_${LESSON_ID_SUFFIX}`;
        const LESSON_CHOICE_MENU_URL = 'questionnaire_35381_lessons_he.html';
        const NEXT_LESSON_URL = 'lesson_35381_statistics_dispersion.html';

        function showNotification(message, type = 'success', duration = 3000) {
            const notificationBox = document.getElementById('notification-box');
            if (!notificationBox) { // Fallback if specific notification-box is not found
                const fallbackNotification = document.createElement('div');
                fallbackNotification.style.position = 'fixed';
                fallbackNotification.style.bottom = '20px';
                fallbackNotification.style.left = '50%';
                fallbackNotification.style.transform = 'translateX(-50%)';
                fallbackNotification.style.padding = '10px 20px';
                fallbackNotification.style.borderRadius = '5px';
                fallbackNotification.style.color = 'white';
                fallbackNotification.style.zIndex = '1000';
                fallbackNotification.style.fontSize = '1em';
                fallbackNotification.className = `notification ${type}`;
                if (type === 'success') fallbackNotification.style.backgroundColor = '#28a745';
                else if (type === 'error') fallbackNotification.style.backgroundColor = '#dc3545';
                else fallbackNotification.style.backgroundColor = '#007bff'; // Default info
                fallbackNotification.textContent = message;
                document.body.appendChild(fallbackNotification);
                setTimeout(() => {
                    fallbackNotification.remove();
                }, duration);
                return;
            }
            // Original notification logic if 'notification-box' exists
            notificationBox.textContent = message;
            notificationBox.className = 'fixed top-5 right-5 text-white p-4 rounded-lg shadow-xl z-50 max-w-sm text-right'; 
            if (type === 'success') notificationBox.classList.add('bg-green-500');
            else if (type === 'error') notificationBox.classList.add('bg-red-500');
            else notificationBox.classList.add('bg-blue-500');
            notificationBox.classList.remove('hidden');
            notificationBox.style.opacity = 1;
            setTimeout(() => {
                notificationBox.style.opacity = 0;
                setTimeout(() => { notificationBox.classList.add('hidden'); }, 500); 
            }, duration);
        }

        function updateButtonVisibility() {
            try {
                const isCompleted = localStorage.getItem(STORAGE_KEY);
                const markCompletedButton = document.getElementById('markCompleted');
                const markNotCompletedButton = document.getElementById('markNotCompleted');

                if (isCompleted === 'true') {
                    if (markCompletedButton) markCompletedButton.style.display = 'none';
                    if (markNotCompletedButton) markNotCompletedButton.style.display = 'inline-block';
                } else {
                    if (markCompletedButton) markCompletedButton.style.display = 'inline-block';
                    if (markNotCompletedButton) markNotCompletedButton.style.display = 'none';
                }
            } catch (e) {
                console.error('Error accessing localStorage:', e);
                showNotification('שגיאה בגישה לאחסון המקומי.', 'error');
            }
        }

        function markLessonAsCompleted() {
            try {
                localStorage.setItem(STORAGE_KEY, 'true');
                updateButtonVisibility();
                showNotification('השיעור סומן כהושלם!', 'success');
            } catch (e) {
                console.error('Error setting localStorage item:', e);
                showNotification('שגיאה בסימון השיעור כהושלם.', 'error');
            }
        }

        function markLessonAsNotCompleted() {
            try {
                localStorage.removeItem(STORAGE_KEY);
                updateButtonVisibility();
                showNotification('השיעור סומן כלא הושלם.', 'success');
            } catch (e) {
                console.error('Error removing localStorage item:', e);
                showNotification('שגיאה בביטול סימון השיעור.', 'error');
            }
        }
        
        document.addEventListener("DOMContentLoaded", function() {
            // From existing script
            if (window.renderMathInElement && document.body) renderMathInElement(document.body);
            if (typeof LESSON_TITLE !== 'undefined') {
                 document.getElementById('lesson-title').textContent = LESSON_TITLE;
                 document.title = LESSON_TITLE + " | פלטפורמת למידה במתמטיקה";
            }
            const breadcrumbQ = document.getElementById('breadcrumb-questionnaire');
            if (breadcrumbQ && typeof BREADCRUMB_QUESTIONNAIRE_TEXT !== 'undefined' && typeof BREADCRUMB_QUESTIONNAIRE_LINK !== 'undefined') {
                breadcrumbQ.textContent = BREADCRUMB_QUESTIONNAIRE_TEXT;
                breadcrumbQ.href = BREADCRUMB_QUESTIONNAIRE_LINK;
            }
            const breadcrumbLessonName = document.getElementById('breadcrumb-lesson-name');
            if (breadcrumbLessonName && typeof LESSON_TITLE !== 'undefined') {
                 breadcrumbLessonName.textContent = LESSON_TITLE;
            }
            const currentYearSpan = document.getElementById('current-year'); // For old footer
            if (currentYearSpan) currentYearSpan.textContent = new Date().getFullYear();
            
            // New standard elements
            const currentYearFooterSpan = document.getElementById('current-year-footer'); // For new footer
            if (currentYearFooterSpan) currentYearFooterSpan.textContent = new Date().getFullYear();

            const markCompletedButton = document.getElementById('markCompleted');
            const markNotCompletedButton = document.getElementById('markNotCompleted');
            const nextLessonLink = document.getElementById('nextLessonLink');
            const lessonChoiceMenuLink = document.getElementById('lessonChoiceMenuLink');

            if (markCompletedButton) markCompletedButton.addEventListener('click', markLessonAsCompleted);
            if (markNotCompletedButton) markNotCompletedButton.addEventListener('click', markLessonAsNotCompleted);

            if (nextLessonLink) nextLessonLink.href = NEXT_LESSON_URL;
            if (lessonChoiceMenuLink) lessonChoiceMenuLink.href = LESSON_CHOICE_MENU_URL;

            updateButtonVisibility(); // Initial check for button states

            // Remove old button event listeners if they exist from previous structure
            const oldMarkDoneButton = document.getElementById("mark-done");
            const oldMarkUndoneButton = document.getElementById("mark-undone");
            if (oldMarkDoneButton) { // Clean up old event listeners if any were attached directly
                const newBtn = oldMarkDoneButton.cloneNode(true);
                oldMarkDoneButton.parentNode.replaceChild(newBtn, oldMarkDoneButton);
            }
            if (oldMarkUndoneButton) {
                 const newBtn = oldMarkUndoneButton.cloneNode(true);
                oldMarkUndoneButton.parentNode.replaceChild(newBtn, oldMarkUndoneButton);
            }
            
            // Existing quiz logic
            const quizSubmitButton = document.getElementById('submit-quiz');
            if (quizSubmitButton && typeof QUIZ_ANSWERS !== 'undefined') {
                quizSubmitButton.addEventListener('click', function() {
                    let score = 0;
                    const quizForm = document.getElementById('quizForm');
                    const totalQuestions = Object.keys(QUIZ_ANSWERS).length;

                    for (const questionKey in QUIZ_ANSWERS) {
                        const userAnswer = quizForm.elements[questionKey] ? quizForm.elements[questionKey].value : null;
                        if (userAnswer === QUIZ_ANSWERS[questionKey]) {
                            score++;
                        }
                    }
                    
                    const resultsEl = document.getElementById('quiz-results');
                    resultsEl.textContent = `הציון שלך הוא: ${score} מתוך ${totalQuestions}.`;
                    if (score === totalQuestions) resultsEl.className = 'mt-3 p-3 rounded-md text-sm bg-green-100 text-green-700';
                    else if (score > 0) resultsEl.className = 'mt-3 p-3 rounded-md text-sm bg-yellow-100 text-yellow-700';
                    else resultsEl.className = 'mt-3 p-3 rounded-md text-sm bg-red-100 text-red-700';
                    resultsEl.classList.remove('hidden');
                    
                    if (typeof recordQuizScore === 'function') recordQuizScore(score, totalQuestions);
                    showNotification(`הבוחן הוגש! ציון: ${score}/${totalQuestions}`, 'info');
                });
            }
            // Call MathJax typesetting if available
             if (typeof MathJax !== 'undefined' && MathJax.typeset) {
                MathJax.typeset();
            }
        });

        // Keep existing functions like checkAnswer, showSolution, recordQuizScore, renderMathInElement
        // Make sure LESSON_ID for recordQuizScore uses LESSON_ID_SUFFIX
        const LESSON_ID = LESSON_ID_SUFFIX; // For compatibility with existing recordQuizScore

        function checkAnswer(exerciseId, correctAnswer, isTuple = false, tolerance = 0.001) {
            const feedbackEl = document.getElementById(`feedback-${exerciseId}`);
            const userAnswerInput = document.getElementById(`${exerciseId}-answer`);
            let userAnswerStr = userAnswerInput.value.trim();
            let isCorrect = false;

            if (isTuple) {
                userAnswerStr = userAnswerStr.replace(/\s/g, '');
                isCorrect = (userAnswerStr === correctAnswer);
            } else {
                const userAnswerNum = parseFloat(userAnswerStr);
                const correctAnswerNum = parseFloat(correctAnswer);
                if (!isNaN(userAnswerNum) && !isNaN(correctAnswerNum)) {
                    isCorrect = Math.abs(userAnswerNum - correctAnswerNum) <= tolerance;
                } else { 
                    isCorrect = (userAnswerStr === correctAnswer);
                }
            }

            if (isCorrect) {
                feedbackEl.textContent = 'נכון מאוד! כל הכבוד! 👍';
                feedbackEl.className = 'feedback mt-3 p-3 rounded-md text-sm bg-green-100 text-green-700';
            } else {
                feedbackEl.textContent = 'תשובה שגויה. נסה שוב או הצג את הפתרון. 🤔';
                feedbackEl.className = 'feedback mt-3 p-3 rounded-md text-sm bg-red-100 text-red-700';
            }
            feedbackEl.classList.remove('hidden');
        }

        function showSolution(solutionId) {
            const solutionEl = document.getElementById(solutionId);
            if (solutionEl) {
                solutionEl.classList.toggle('hidden');
                if (!solutionEl.classList.contains('hidden') && typeof renderMathInElement === 'function') {
                     renderMathInElement(solutionEl);
                }
            }
        }
        
        const QUIZ_ANSWERS = { q1: 'a', q2: 'b' }; 
        // Q1: M0=500, p=3% decay, t=6. q = 0.97. M6 = 500 * (0.97)^6 = 500 * 0.83298428... approx 416.49.
        // Q2: Mt=200 (current), p=15% decay, t=2 (looking for M0). M0 = Mt / q^t = 200 / (0.85)^2 = 200 / 0.7225 approx 276.8166... -> 276.82.
        
        function recordQuizScore(score, totalQuestions) {
            // LESSON_ID is now LESSON_ID_SUFFIX for consistency with STORAGE_KEY
            if (typeof LESSON_ID_SUFFIX === 'undefined' || !LESSON_ID_SUFFIX) {
                console.error("LESSON_ID_SUFFIX is not defined for recordQuizScore.");
                return;
            }
            try {
                localStorage.setItem(`lesson_quiz_score_${LESSON_ID_SUFFIX}`, JSON.stringify({score, total: totalQuestions, date: new Date().toISOString()}));
            } catch (e) {
                console.error("Error saving quiz score to localStorage:", e);
            }
        }
        
        function renderMathInElement(element) { // This function was defined in the original script, ensure it's kept
            if (window.MathJax && window.MathJax.typesetPromise && element) {
                 window.MathJax.typesetPromise([element]).catch(function (err) {
                    console.error('MathJax typesetting error: ' + err);
                 });
            } else if (window.renderMathInElement && element) { // Fallback for older KaTeX setup if present
                 window.renderMathInElement(element, {
                    delimiters: [
                        {left: "$$", right: "$$", display: true}, {left: "$", right: "$", display: false},
                        {left: "\\(", right: "\\)", display: false}, {left: "\\[", right: "\\]", display: true}
                    ],
                    throwOnError: false
                });
            }
        }
    </script>
</body>
</html>


