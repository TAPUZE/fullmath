<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>גדילה ודעיכה | פלטפורמת למידה במתמטיקה</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44SU3AYApZ293QOtcPZFJBDEkkVerc4hrGMDhS2FL" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Assistant', sans-serif;
        }
        .formula-box {
            background-color: #E5E7EB; /* bg-gray-200 */
            padding: 0.75rem; 
            border-radius: 0.375rem; /* rounded-md */
            display: inline-block; 
            font-size: 1.125em; /* text-lg */
            line-height: 1.5; 
            margin-top: 0.25rem;
            margin-bottom: 0.25rem;
        }
        .formula-box[dir="ltr"] .katex {
            text-align: left !important;
        }
        #notification-box {
            transition: opacity 0.5s ease-in-out;
        }
        .solution {
            background-color: #f3f4f6; 
            border: 1px solid #d1d5db; 
        }
        .feedback.bg-green-100 { border: 1px solid #a7f3d0; }
        .feedback.bg-red-100 { border: 1px solid #fecaca; }
        .feedback.bg-yellow-100 { border: 1px solid #fde68a; }
        .katex-display > .katex { text-align: center; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div id="notification-box" class="fixed top-5 right-5 text-white p-4 rounded-lg shadow-xl hidden z-50 max-w-sm text-right">
        הודעה תוצג כאן
    </div>

    <div class="container mx-auto p-4 md:p-8 max-w-5xl">
        <header class="mb-8">
            <nav aria-label="breadcrumb" class="text-sm text-gray-600 mb-2">
                <ol class="list-none p-0 inline-flex">
                    <li class="flex items-center">
                        <a href="math_platform_main_page_he.html" class="hover:underline">דף ראשי</a>
                        <svg class="fill-current w-3 h-3 mx-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg>
                    </li>
                    <li class="flex items-center">
                        <a href="questionnaire_35381_lessons_page_he.html" id="breadcrumb-questionnaire" class="hover:underline">שאלון 35381</a>
                        <svg class="fill-current w-3 h-3 mx-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg>
                    </li>
                    <li class="flex items-center">
                        <span id="breadcrumb-lesson-name" class="text-gray-500">גדילה ודעיכה</span>
                    </li>
                </ol>
            </nav>
            <h1 id="lesson-title" class="text-3xl md:text-4xl font-bold text-green-700">גדילה ודעיכה</h1>
        </header>

        <main class="bg-white p-6 md:p-8 rounded-lg shadow-lg">

            <section id="learn" aria-labelledby="learn-heading" class="mb-12">
                <h2 id="learn-heading" class="text-2xl font-semibold text-green-600 mb-4 border-b-2 border-green-200 pb-2">לומדים 📚</h2>
                <div class="space-y-4 text-gray-700 leading-relaxed">
                    <p>תהליכי גדילה ודעיכה מתארים מצבים שבהם כמות מסוימת משתנה באחוז קבוע בכל תקופת זמן (למשל, כל שנה, כל שעה וכו'). דוגמאות נפוצות כוללות גידול אוכלוסייה, עליית ערך של השקעה (ריבית דריבית), ירידת ערך של מוצר (פחת), או דעיכה של חומר רדיואקטיבי.</p>
                    
                    <h3 class="text-xl font-semibold mt-6 mb-2 text-gray-800">הנוסחה המרכזית לגדילה ודעיכה</h3>
                    <p>הנוסחה לחישוב הכמות לאחר מספר תקופות זמן היא:</p>
                    <div class="my-3 text-center">
                        <span class="formula-box" dir="ltr">\(M_t = M_0 \cdot q^t\)</span>
                    </div>
                    <p>כאשר:</p>
                    <ul class="list-disc pr-6 space-y-2 my-2">
                        <li><span class="formula-box" dir="ltr">\(M_t\)</span> היא הכמות הסופית, לאחר <span class="formula-box" dir="ltr">\(t\)</span> תקופות זמן.</li>
                        <li><span class="formula-box" dir="ltr">\(M_0\)</span> היא הכמות ההתחלתית (בזמן <span class="formula-box" dir="ltr">\(t=0\)</span>).</li>
                        <li><span class="formula-box" dir="ltr">\(q\)</span> הוא גורם השינוי (גורם הגדילה או הדעיכה) בכל תקופת זמן.</li>
                        <li><span class="formula-box" dir="ltr">\(t\)</span> הוא מספר תקופות הזמן שעברו.</li>
                    </ul>

                    <h4 class="text-lg font-semibold mt-4 mb-1 text-gray-800">כיצד מחשבים את <span class="formula-box" dir="ltr">\(q\)</span>?</h4>
                    <p>אם הכמות גדלה ב-<span class="formula-box" dir="ltr">\(p\%\)</span> בכל תקופת זמן, אז גורם הגדילה הוא: <span class="formula-box" dir="ltr">\(q = 1 + \frac{p}{100}\)</span>.</p>
                    <p>לדוגמה, אם המחיר עולה ב-10% כל שנה, אז <span class="formula-box" dir="ltr">\(p=10\)</span>, ו-<span class="formula-box" dir="ltr">\(q = 1 + \frac{10}{100} = 1 + 0.1 = 1.1\)</span>.</p>
                    <p>אם הכמות קטנה (דועכת) ב-<span class="formula-box" dir="ltr">\(p\%\)</span> בכל תקופת זמן, אז גורם הדעיכה הוא: <span class="formula-box" dir="ltr">\(q = 1 - \frac{p}{100}\)</span>.</p>
                    <p>לדוגמה, אם ערך מכונית יורד ב-15% כל שנה, אז <span class="formula-box" dir="ltr">\(p=15\)</span>, ו-<span class="formula-box" dir="ltr">\(q = 1 - \frac{15}{100} = 1 - 0.15 = 0.85\)</span>.</p>
                    <p>שימו לב: אם <span class="formula-box" dir="ltr">\(q > 1\)</span> מדובר בתהליך גדילה, ואם <span class="formula-box" dir="ltr">\(0 < q < 1\)</span> מדובר בתהליך דעיכה.</p>


                    <h3 class="text-xl font-semibold mt-8 mb-2 text-gray-800">דוגמאות פתורות</h3>
                    <div class="border border-gray-200 rounded-lg p-4 bg-gray-50 space-y-3 mb-6">
                        <p class="font-medium"><strong>דוגמה 1: גידול אוכלוסייה</strong></p>
                        <p>אוכלוסיית חיידקים גדלה ב-20% בכל שעה. בתחילת הניסוי היו 1000 חיידקים. כמה חיידקים יהיו כעבור 3 שעות?</p>
                        <p><strong>פתרון:</strong></p>
                        <ul class="list-disc pr-5 space-y-1">
                            <li>הכמות ההתחלתית: <span class="formula-box" dir="ltr">\(M_0 = 1000\)</span>.</li>
                            <li>אחוז הגדילה לשעה: <span class="formula-box" dir="ltr">\(p = 20\%\)</span>.</li>
                            <li>גורם הגדילה: <span class="formula-box" dir="ltr">\(q = 1 + \frac{20}{100} = 1 + 0.2 = 1.2\)</span>.</li>
                            <li>מספר תקופות הזמן (שעות): <span class="formula-box" dir="ltr">\(t = 3\)</span>.</li>
                        </ul>
                        <p>נציב בנוסחה <span class="formula-box" dir="ltr">\(M_t = M_0 \cdot q^t\)</span>:</p>
                        <div class="my-2 text-center">
                             <span class="formula-box" dir="ltr">\(M_3 = 1000 \cdot (1.2)^3\)</span>
                        </div>
                        <div class="my-2 text-center">
                             <span class="formula-box" dir="ltr">\(M_3 = 1000 \cdot 1.728 = 1728\)</span>
                        </div>
                        <p>תשובה: כעבור 3 שעות יהיו 1728 חיידקים.</p>
                    </div>

                    <div class="border border-gray-200 rounded-lg p-4 bg-gray-50 space-y-3 mb-6">
                        <p class="font-medium"><strong>דוגמה 2: ירידת ערך (פחת)</strong></p>
                        <p>מחיר מכונית חדשה הוא 120,000 ש"ח. ערך המכונית יורד ב-10% בכל שנה. מה יהיה ערך המכונית כעבור 4 שנים?</p>
                        <p><strong>פתרון:</strong></p>
                        <ul class="list-disc pr-5 space-y-1">
                            <li>הכמות ההתחלתית (מחיר התחלתי): <span class="formula-box" dir="ltr">\(M_0 = 120,000\)</span>.</li>
                            <li>אחוז הדעיכה לשנה: <span class="formula-box" dir="ltr">\(p = 10\%\)</span>.</li>
                            <li>גורם הדעיכה: <span class="formula-box" dir="ltr">\(q = 1 - \frac{10}{100} = 1 - 0.1 = 0.9\)</span>.</li>
                            <li>מספר תקופות הזמן (שנים): <span class="formula-box" dir="ltr">\(t = 4\)</span>.</li>
                        </ul>
                        <p>נציב בנוסחה <span class="formula-box" dir="ltr">\(M_t = M_0 \cdot q^t\)</span>:</p>
                        <div class="my-2 text-center">
                             <span class="formula-box" dir="ltr">\(M_4 = 120,000 \cdot (0.9)^4\)</span>
                        </div>
                        <div class="my-2 text-center">
                             <span class="formula-box" dir="ltr">\(M_4 = 120,000 \cdot 0.6561 = 78,732\)</span>
                        </div>
                        <p>תשובה: כעבור 4 שנים, ערך המכונית יהיה 78,732 ש"ח.</p>
                    </div>
                     <div class="border border-gray-200 rounded-lg p-4 bg-gray-50 space-y-3">
                        <p class="font-medium"><strong>דוגמה 3: מציאת הכמות ההתחלתית</strong></p>
                        <p>לאחר 5 שנים, ערכו של פריט מסוים הוא 1500 ש"ח. ידוע כי ערך הפריט יורד ב-8% כל שנה. מה היה מחירו ההתחלתי של הפריט?</p>
                        <p><strong>פתרון:</strong></p>
                        <ul class="list-disc pr-5 space-y-1">
                            <li>הכמות הסופית: <span class="formula-box" dir="ltr">\(M_t = 1500\)</span> (כאשר <span class="formula-box" dir="ltr">\(t=5\)</span>).</li>
                            <li>אחוז הדעיכה לשנה: <span class="formula-box" dir="ltr">\(p = 8\%\)</span>.</li>
                            <li>גורם הדעיכה: <span class="formula-box" dir="ltr">\(q = 1 - \frac{8}{100} = 1 - 0.08 = 0.92\)</span>.</li>
                            <li>מספר תקופות הזמן (שנים): <span class="formula-box" dir="ltr">\(t = 5\)</span>.</li>
                            <li>אנחנו מחפשים את <span class="formula-box" dir="ltr">\(M_0\)</span>.</li>
                        </ul>
                        <p>נציב בנוסחה <span class="formula-box" dir="ltr">\(M_t = M_0 \cdot q^t\)</span>:</p>
                        <div class="my-2 text-center">
                             <span class="formula-box" dir="ltr">\(1500 = M_0 \cdot (0.92)^5\)</span>
                        </div>
                        <p>נחשב את <span class="formula-box" dir="ltr">\((0.92)^5 \approx 0.65908\)</span> (מומלץ להשתמש במחשבון).</p>
                        <div class="my-2 text-center">
                            <span class="formula-box" dir="ltr">\(1500 = M_0 \cdot 0.65908\)</span>
                        </div>
                        <div class="my-2 text-center">
                            <span class="formula-box" dir="ltr">\(M_0 = \frac{1500}{0.65908} \approx 2275.94\)</span>
                        </div>
                        <p>תשובה: מחירו ההתחלתי של הפריט היה כ-2275.94 ש"ח.</p>
                    </div>
                </div>
            </section>

            <section id="practice" aria-labelledby="practice-heading" class="mb-12">
                <h2 id="practice-heading" class="text-2xl font-semibold text-green-600 mb-4 border-b-2 border-green-200 pb-2">מתרגלים ✍️</h2>
                <div class="space-y-6">
                    <div class="exercise p-4 border border-gray-300 rounded-lg bg-gray-50">
                        <p class="exercise-question font-medium"><strong>תרגיל 1:</strong> סכום כסף הופקד בבנק בתוכנית חיסכון הנושאת ריבית דריבית שנתית של 5%. לאחר 6 שנים היו בתוכנית 2680.19 ש"ח. מה היה הסכום ההתחלתי שהופקד? (עגל לשתי ספרות אחרי הנקודה)</p>
                        <div class="mt-3">
                            <input type="text" id="ex1-answer" class="border border-gray-300 p-2 rounded w-full md:w-1/2 focus:ring-green-500 focus:border-green-500" placeholder="הכנס סכום התחלתי">
                        </div>
                        <div class="mt-3">
                            <button onclick="checkAnswer('ex1', '2000.00', false, 0.01)" class="check-answer-btn bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-md transition duration-150 ease-in-out">בדוק תשובה</button>
                            <button onclick="showSolution('sol1')" class="show-solution-btn bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-md transition duration-150 ease-in-out ml-2">הצג פתרון</button>
                        </div>
                        <div id="feedback-ex1" class="feedback hidden mt-3 p-3 rounded-md text-sm"></div>
                        <div id="sol1" class="solution hidden mt-3 p-3 border-t border-gray-200 bg-white rounded-md">
                            <p><strong>פתרון מלא:</strong></p>
                            <p>נתונים: <span class="formula-box" dir="ltr">\(M_t = 2680.19\)</span>, <span class="formula-box" dir="ltr">\(p = 5\%\)</span>, <span class="formula-box" dir="ltr">\(t = 6\)</span>. מחפשים <span class="formula-box" dir="ltr">\(M_0\)</span>.</p>
                            <p>גורם הגדילה: <span class="formula-box" dir="ltr">\(q = 1 + \frac{5}{100} = 1.05\)</span>.</p>
                            <p>נציב בנוסחה <span class="formula-box" dir="ltr">\(M_t = M_0 \cdot q^t\)</span>:</p>
                            <p><span class="formula-box" dir="ltr">\(2680.19 = M_0 \cdot (1.05)^6\)</span></p>
                            <p><span class="formula-box" dir="ltr">\((1.05)^6 \approx 1.3400956\)</span></p>
                            <p><span class="formula-box" dir="ltr">\(M_0 = \frac{2680.19}{1.3400956} \approx 1999.999...\)</span></p>
                            <p>תשובה: הסכום ההתחלתי היה 2000.00 ש"ח.</p>
                        </div>
                    </div>

                    <div class="exercise p-4 border border-gray-300 rounded-lg bg-gray-50">
                        <p class="exercise-question font-medium"><strong>תרגיל 2:</strong> מספר התושבים בעיר מסוימת היה 50,000 בתחילת שנת 2010. בכל שנה גדלה האוכלוסייה בעיר ב-2.5%. מה יהיה מספר התושבים בעיר בתחילת שנת 2015? (עגל למספר שלם קרוב)</p>
                        <div class="mt-3">
                            <input type="text" id="ex2-answer" class="border border-gray-300 p-2 rounded w-full md:w-1/2 focus:ring-green-500 focus:border-green-500" placeholder="הכנס מספר תושבים">
                        </div>
                        <div class="mt-3">
                            <button onclick="checkAnswer('ex2', '56570', false, 1)" class="check-answer-btn bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-md transition duration-150 ease-in-out">בדוק תשובה</button>
                            <button onclick="showSolution('sol2')" class="show-solution-btn bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-md transition duration-150 ease-in-out ml-2">הצג פתרון</button>
                        </div>
                        <div id="feedback-ex2" class="feedback hidden mt-3 p-3 rounded-md text-sm"></div>
                        <div id="sol2" class="solution hidden mt-3 p-3 border-t border-gray-200 bg-white rounded-md">
                            <p><strong>פתרון מלא:</strong></p>
                            <p>נתונים: <span class="formula-box" dir="ltr">\(M_0 = 50,000\)</span>, <span class="formula-box" dir="ltr">\(p = 2.5\%\)</span>.</p>
                            <p>מספר השנים: מתחילת 2010 עד תחילת 2015 עברו 5 שנים. לכן, <span class="formula-box" dir="ltr">\(t = 5\)</span>.</p>
                            <p>גורם הגדילה: <span class="formula-box" dir="ltr">\(q = 1 + \frac{2.5}{100} = 1.025\)</span>.</p>
                             <p>נציב בנוסחה <span class="formula-box" dir="ltr">\(M_t = M_0 \cdot q^t\)</span>:</p>
                            <p><span class="formula-box" dir="ltr">\(M_5 = 50,000 \cdot (1.025)^5\)</span></p>
                            <p><span class="formula-box" dir="ltr">\((1.025)^5 \approx 1.131408\)</span></p>
                            <p><span class="formula-box" dir="ltr">\(M_5 = 50,000 \cdot 1.131408 \approx 56570.4\)</span></p>
                            <p>תשובה: מספר התושבים יהיה כ-56,570.</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="test-yourself" aria-labelledby="test-heading" class="mb-12">
                <h2 id="test-heading" class="text-2xl font-semibold text-green-600 mb-4 border-b-2 border-green-200 pb-2">בחן את עצמך 🧐</h2>
                <form id="quizForm" class="space-y-6">
                    <div class="quiz-question p-4 border border-gray-300 rounded-lg bg-gray-50">
                        <p class="font-medium"><strong>שאלה 1:</strong> מחיר מוצר יורד בכל חודש ב-3%. מחירו ההתחלתי 500 ש"ח. מה יהיה מחירו לאחר חצי שנה (6 חודשים)? (עגל לשתי ספרות אחרי הנקודה)</p>
                        <div class="mt-2 space-y-1">
                            <label class="flex items-center"><input type="radio" name="q1" value="a" class="form-radio text-green-600 ml-2"> 416.49 ש"ח</label>
                            <label class="flex items-center"><input type="radio" name="q1" value="b" class="form-radio text-green-600 ml-2"> 410.00 ש"ח</label>
                            <label class="flex items-center"><input type="radio" name="q1" value="c" class="form-radio text-green-600 ml-2"> 425.72 ש"ח</label>
                        </div>
                    </div>
                    <div class="quiz-question p-4 border border-gray-300 rounded-lg bg-gray-50">
                        <p class="font-medium"><strong>שאלה 2:</strong> חומר רדיואקטיבי מאבד 15% ממשקלו בכל יום. אם כיום יש 200 גרם מהחומר, כמה גרם היו ממנו לפני יומיים? (עגל לשתי ספרות אחרי הנקודה)</p>
                         <div class="mt-2 space-y-1">
                            <label class="flex items-center"><input type="radio" name="q2" value="a" class="form-radio text-green-600 ml-2"> 262.83 גרם</label>
                            <label class="flex items-center"><input type="radio" name="q2" value="b" class="form-radio text-green-600 ml-2"> 276.82 גרם</label>
                            <label class="flex items-center"><input type="radio" name="q2" value="c" class="form-radio text-green-600 ml-2"> 230.00 גרם</label>
                        </div>
                    </div>
                    <button type="button" id="submit-quiz" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md transition duration-150 ease-in-out">הגש בוחן</button>
                </form>
                <div id="quiz-results" class="hidden mt-3 p-3 rounded-md text-sm"></div>
            </section>

            <section id="progress" aria-labelledby="progress-heading" class="text-center mt-12 py-8">
                 <button id="mark-completed" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg text-lg transition duration-150 ease-in-out shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
                    סמן שיעור כהושלם ✅
                </button>
            </section>
        </main>

        <footer class="text-center text-gray-600 mt-12 py-4 border-t border-gray-300">
            <p>&copy; <span id="current-year"></span> פלטפורמת למידה במתמטיקה. כל הזכויות שמורות.</p>
        </footer>
    </div>

    <script>
        const LESSON_ID = '35381_growth_decay'; 
        const LESSON_TITLE = 'גדילה ודעיכה';
        const BREADCRUMB_QUESTIONNAIRE_TEXT = 'שאלון 35381';
        const BREADCRUMB_QUESTIONNAIRE_LINK = 'questionnaire_35381_lessons_page_he.html';
        // BREADCRUMB_MAIN_TOPIC_TEXT is not needed here as the lesson itself is a main topic
        
        const QUIZ_ANSWERS = { q1: 'a', q2: 'b' }; 
        // Q1: M0=500, p=3% decay, t=6. q = 0.97. M6 = 500 * (0.97)^6 = 500 * 0.83298428... approx 416.49.
        // Q2: Mt=200 (current), p=15% decay, t=2 (looking for M0). M0 = Mt / q^t = 200 / (0.85)^2 = 200 / 0.7225 approx 276.8166... -> 276.82.
        
        document.addEventListener("DOMContentLoaded", function() {
            renderMathInElement(document.body);
            document.getElementById('lesson-title').textContent = LESSON_TITLE;
            document.title = LESSON_TITLE + " | פלטפורמת למידה במתמטיקה";
            
            const breadcrumbQ = document.getElementById('breadcrumb-questionnaire');
            breadcrumbQ.textContent = BREADCRUMB_QUESTIONNAIRE_TEXT;
            breadcrumbQ.href = BREADCRUMB_QUESTIONNAIRE_LINK;
            
            document.getElementById('breadcrumb-lesson-name').textContent = LESSON_TITLE;
            document.getElementById('current-year').textContent = new Date().getFullYear();
            checkLessonStatus();
        });

        function showNotification(message, type = 'info', duration = 3000) {
            const notificationBox = document.getElementById('notification-box');
            if (!notificationBox) return;
            notificationBox.textContent = message;
            notificationBox.className = 'fixed top-5 right-5 text-white p-4 rounded-lg shadow-xl z-50 max-w-sm text-right'; 
            if (type === 'success') notificationBox.classList.add('bg-green-500');
            else if (type === 'error') notificationBox.classList.add('bg-red-500');
            else notificationBox.classList.add('bg-blue-500');
            notificationBox.classList.remove('hidden');
            notificationBox.style.opacity = 1;
            setTimeout(() => {
                notificationBox.style.opacity = 0;
                setTimeout(() => { notificationBox.classList.add('hidden'); }, 500); 
            }, duration);
        }

        function checkAnswer(exerciseId, correctAnswer, isTuple = false, tolerance = 0.001) {
            const feedbackEl = document.getElementById(`feedback-${exerciseId}`);
            const userAnswerInput = document.getElementById(`${exerciseId}-answer`);
            let userAnswerStr = userAnswerInput.value.trim();
            let isCorrect = false;

            if (isTuple) {
                userAnswerStr = userAnswerStr.replace(/\s/g, '');
                isCorrect = (userAnswerStr === correctAnswer);
            } else {
                const userAnswerNum = parseFloat(userAnswerStr);
                const correctAnswerNum = parseFloat(correctAnswer);
                if (!isNaN(userAnswerNum) && !isNaN(correctAnswerNum)) {
                    isCorrect = Math.abs(userAnswerNum - correctAnswerNum) <= tolerance;
                } else { 
                    isCorrect = (userAnswerStr === correctAnswer);
                }
            }

            if (isCorrect) {
                feedbackEl.textContent = 'נכון מאוד! כל הכבוד! 👍';
                feedbackEl.className = 'feedback mt-3 p-3 rounded-md text-sm bg-green-100 text-green-700';
            } else {
                feedbackEl.textContent = 'תשובה שגויה. נסה שוב או הצג את הפתרון. 🤔';
                feedbackEl.className = 'feedback mt-3 p-3 rounded-md text-sm bg-red-100 text-red-700';
            }
            feedbackEl.classList.remove('hidden');
        }

        function showSolution(solutionId) {
            const solutionEl = document.getElementById(solutionId);
            if (solutionEl) {
                solutionEl.classList.toggle('hidden');
                if (!solutionEl.classList.contains('hidden')) {
                     renderMathInElement(solutionEl);
                }
            }
        }
        
        const quizSubmitButton = document.getElementById('submit-quiz');
        if (quizSubmitButton) {
            quizSubmitButton.addEventListener('click', function() {
                let score = 0;
                const quizForm = document.getElementById('quizForm');
                const totalQuestions = Object.keys(QUIZ_ANSWERS).length;

                for (const questionKey in QUIZ_ANSWERS) {
                    const userAnswer = quizForm.elements[questionKey] ? quizForm.elements[questionKey].value : null;
                    if (userAnswer === QUIZ_ANSWERS[questionKey]) {
                        score++;
                    }
                }
                
                const resultsEl = document.getElementById('quiz-results');
                resultsEl.textContent = `הציון שלך הוא: ${score} מתוך ${totalQuestions}.`;
                if (score === totalQuestions) resultsEl.className = 'mt-3 p-3 rounded-md text-sm bg-green-100 text-green-700';
                else if (score > 0) resultsEl.className = 'mt-3 p-3 rounded-md text-sm bg-yellow-100 text-yellow-700';
                else resultsEl.className = 'mt-3 p-3 rounded-md text-sm bg-red-100 text-red-700';
                resultsEl.classList.remove('hidden');
                
                recordQuizScore(score, totalQuestions);
                showNotification(`הבוחן הוגש! ציון: ${score}/${totalQuestions}`, 'info');
            });
        }

        const markCompletedButton = document.getElementById('mark-completed');
        if (markCompletedButton) {
            markCompletedButton.addEventListener('click', function() { markLessonAsCompleted(); });
        }

        function markLessonAsCompleted() {
            if (!LESSON_ID) { showNotification("שגיאה: לא ניתן היה לזהות את השיעור.", "error"); return; }
            try {
                localStorage.setItem(`lesson_completed_${LESSON_ID}`, 'true');
                showNotification('השיעור סומן כהושלם!', 'success');
                if(markCompletedButton) {
                    markCompletedButton.textContent = 'השיעור הושלם 👍';
                    markCompletedButton.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                    markCompletedButton.classList.add('bg-green-600', 'cursor-not-allowed');
                    markCompletedButton.disabled = true;
                }
            } catch (e) { showNotification("שגיאה בשמירת ההתקדמות.", "error"); }
        }

        function recordQuizScore(score, totalQuestions) {
            if (!LESSON_ID) return;
            try { localStorage.setItem(`lesson_quiz_score_${LESSON_ID}`, JSON.stringify({score, total: totalQuestions, date: new Date().toISOString()}));
            } catch (e) { console.error("Error saving quiz score to localStorage:", e); }
        }

        function checkLessonStatus() {
            if (!LESSON_ID) return;
            try {
                const isCompleted = localStorage.getItem(`lesson_completed_${LESSON_ID}`);
                if (isCompleted === 'true' && markCompletedButton) {
                    markCompletedButton.textContent = 'השיעור הושלם 👍';
                    markCompletedButton.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                    markCompletedButton.classList.add('bg-green-600', 'cursor-not-allowed');
                    markCompletedButton.disabled = true;
                }
            } catch (e) { console.error("Error accessing localStorage:", e); }
        }
        
        function renderMathInElement(element) {
            if (window.renderMathInElement && element) {
                window.renderMathInElement(element, {
                    delimiters: [
                        {left: "$$", right: "$$", display: true}, {left: "$", right: "$", display: false},
                        {left: "\\(", right: "\\)", display: false}, {left: "\\[", right: "\\]", display: true}
                    ],
                    throwOnError: false
                });
            }
        }
    </script>
</body>
</html>
