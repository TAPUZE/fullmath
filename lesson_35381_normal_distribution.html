<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>התפלגות נורמלית - פלטפורמת למידה במתמטיקה</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUbKyJZo8" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Assistant', sans-serif;
            background-color: #f9fafb; /* Tailwind bg-gray-50 */
        }
        .formula-box {
            background-color: #f3f4f6; /* Tailwind bg-gray-100 */
            padding: 0.75rem; /* p-3 */
            border-radius: 0.375rem; /* rounded-md */
            font-size: 1.15em; /* Slightly larger font */
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
            display: block; /* Ensures it takes block space */
            overflow-x: auto; /* For very long formulas if necessary */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        .feedback-correct {
            color: #16a34a; /* Tailwind green-600 */
            font-weight: bold;
        }
        .feedback-incorrect {
            color: #dc2626; /* Tailwind red-600 */
            font-weight: bold;
        }
        .solution-box {
            background-color: #eef2ff; /* Tailwind bg-indigo-50 */
            border: 1px solid #c7d2fe; /* Tailwind border-indigo-200 */
            padding: 0.75rem;
            margin-top: 0.5rem;
            border-radius: 0.375rem;
        }
        /* SVG text font */
        .svg-text {
            font-family: 'Assistant', sans-serif;
            font-size: 10px;
            fill: #374151; /* gray-700 */
        }
        .svg-text-small {
            font-family: 'Assistant', sans-serif;
            font-size: 8px;
            fill: #4b5563; /* gray-600 */
        }
        .svg-line {
            stroke: #9ca3af; /* gray-400 */
            stroke-width:1;
        }
        .svg-line-bold {
            stroke: #4f46e5; /* indigo-600 */
            stroke-width:1.5;
        }
        .svg-area-fill {
            fill: #a5b4fc; /* indigo-300 */
            opacity: 0.5;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <div class="container mx-auto p-4 max-w-4xl min-h-screen flex flex-col">

        <header class="mb-8">
            <nav class="text-sm text-gray-500 mb-2" aria-label="Breadcrumb">
                <ol class="list-none p-0 inline-flex">
                    <li class="flex items-center">
                        <a href="math_platform_main_page_he.html" class="hover:underline">דף הבית</a>
                        <svg class="fill-current w-3 h-3 mx-3 transform rotate-180" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M7 10l5-5 5 5H7z"/></svg>
                    </li>
                    <li class="flex items-center">
                         <a href="questionnaire_35381_lessons_page_he.html" class="hover:underline">שאלון 35381</a>
                        <svg class="fill-current w-3 h-3 mx-3 transform rotate-180" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M7 10l5-5 5 5H7z"/></svg>
                    </li>
                    <li class="flex items-center">
                        <span class="text-gray-700">סטטיסטיקה</span>
                         <svg class="fill-current w-3 h-3 mx-3 transform rotate-180" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M7 10l5-5 5 5H7z"/></svg>
                    </li>
                     <li class="flex items-center">
                        <span class="text-gray-700 font-semibold">התפלגות נורמלית</span>
                    </li>
                </ol>
            </nav>
            <h1 id="lessonTitle" class="text-3xl font-bold text-indigo-700">התפלגות נורמלית</h1>
        </header>

        <main class="flex-grow">
            <section id="learnSection" class="mb-12 p-6 bg-white rounded-lg shadow-lg">
                <h2 class="text-2xl font-semibold mb-6 text-indigo-600 border-b pb-2">לומדים: מהי התפלגות נורמלית?</h2>
                <p class="mb-4">ההתפלגות הנורמלית, המוכרת גם בשם "עקומת הפעמון" או "התפלגות גאוס", היא אחת ההתפלגויות החשובות ביותר בסטטיסטיקה. היא מתארת כיצד נתונים רבים בטבע ובמדעי החברה נוטים להתקבץ סביב ערך ממוצע, כאשר רוב הערכים קרובים לממוצע ומספר הערכים הקיצוניים (רחוקים מאוד מהממוצע) הוא קטן יחסית.</p>
                <p class="mb-4">מאפיינים עיקריים של ההתפלגות הנורמלית:</p>
                <ul class="list-disc list-inside mb-4 space-y-1">
                    <li><strong>סימטריה:</strong> העקומה סימטרית לחלוטין סביב הממוצע. הממוצע, החציון והשכיח הם כולם באותה נקודה במרכז ההתפלגות.</li>
                    <li><strong>צורת פעמון:</strong> לעקומה צורת פעמון אופיינית, עם שיא בממוצע ודעיכה הדרגתית של השכיחות ככל שמתרחקים מהממוצע לשני הכיוונים.</li>
                    <li><strong>פרמטרים:</strong> ההתפלגות הנורמלית מוגדרת על ידי שני פרמטרים:
                        <ul class="list-disc list-inside ml-6 mt-1">
                            <li><strong>ממוצע (<span dir="ltr">\(\mu\)</span>):</strong> מציין את מרכז ההתפלגות.</li>
                            <li><strong>סטיית תקן (<span dir="ltr">\(\sigma\)</span>):</strong> מציינת את מידת הפיזור של הנתונים סביב הממוצע. סטיית תקן קטנה יותר משמעה שהנתונים מקובצים קרוב יותר לממוצע (עקומה צרה וגבוהה יותר), וסטיית תקן גדולה יותר משמעה שהנתונים מפוזרים יותר (עקומה רחבה ונמוכה יותר).</li>
                        </ul>
                    </li>
                </ul>

                <h3 class="text-xl font-semibold mt-6 mb-3 text-indigo-500">עקומת ההתפלגות הנורמלית הסטנדרטית (כלל 68-95-99.7)</h3>
                <p class="mb-4">בהתפלגות נורמלית, ניתן להעריך את אחוז הנתונים הנמצאים במרחקים מסוימים מהממוצע, הנמדדים ביחידות של סטיות תקן:</p>
                <ul class="list-disc list-inside mb-4 space-y-1">
                    <li>כ-<strong>68.2%</strong> מהנתונים נמצאים במרחק של עד סטיית תקן אחת מהממוצע (כלומר, בתחום <span dir="ltr">\(\mu \pm \sigma\)</span>).</li>
                    <li>כ-<strong>95.4%</strong> מהנתונים נמצאים במרחק של עד שתי סטיות תקן מהממוצע (כלומר, בתחום <span dir="ltr">\(\mu \pm 2\sigma\)</span>).</li>
                    <li>כ-<strong>99.7%</strong> מהנתונים נמצאים במרחק של עד שלוש סטיות תקן מהממוצע (כלומר, בתחום <span dir="ltr">\(\mu \pm 3\sigma\)</span>).</li>
                </ul>

                <div class="my-6 p-4 border rounded-md bg-gray-50 flex justify-center items-center">
                    <svg width="100%" height="300" viewBox="0 0 400 200" xmlns="http://www.w3.org/2000/svg" class="bg-white border rounded-md shadow">
                        <path d="M20,180 C20,180 70,20 200,20 C330,20 380,180 380,180 Z" fill="#c7d2fe" fill-opacity="0.3"/> <path d="M20,180 C20,180 70,20 200,20 C330,20 380,180 380,180" stroke="#4f46e5" stroke-width="2" fill="none"/> <line x1="10" y1="180" x2="390" y2="180" class="svg-line-bold" />

                        <line x1="200" y1="20" x2="200" y2="185" class="svg-line" stroke-dasharray="4 2"/>
                        <text x="195" y="195" class="svg-text">\(\mu\)</text>

                        <line x1="250" y1="100" x2="250" y2="182" class="svg-line" stroke-dasharray="2 2"/>
                        <text x="240" y="195" class="svg-text-small">\(\mu+\sigma\)</text>
                        <line x1="150" y1="100" x2="150" y2="182" class="svg-line" stroke-dasharray="2 2"/>
                        <text x="135" y="195" class="svg-text-small">\(\mu-\sigma\)</text>

                        <line x1="300" y1="150" x2="300" y2="182" class="svg-line" stroke-dasharray="2 2"/>
                        <text x="285" y="195" class="svg-text-small">\(\mu+2\sigma\)</text>
                        <line x1="100" y1="150" x2="100" y2="182" class="svg-line" stroke-dasharray="2 2"/>
                        <text x="80" y="195" class="svg-text-small">\(\mu-2\sigma\)</text>

                        <line x1="350" y1="170" x2="350" y2="182" class="svg-line" stroke-dasharray="2 2"/>
                        <text x="335" y="195" class="svg-text-small">\(\mu+3\sigma\)</text>
                        <line x1="50" y1="170" x2="50" y2="182" class="svg-line" stroke-dasharray="2 2"/>
                        <text x="30" y="195" class="svg-text-small">\(\mu-3\sigma\)</text>

                        <text x="190" y="80" class="svg-text-small">34.1%</text>
                        <text x="240" y="80" class="svg-text-small">34.1%</text>
                        <text x="140" y="120" class="svg-text-small">13.6%</text>
                        <text x="290" y="120" class="svg-text-small">13.6%</text>
                        <text x="90" y="155" class="svg-text-small">2.1%</text>
                        <text x="340" y="155" class="svg-text-small">2.1%</text>
                        
                        <path d="M150,180 C150,180 160,100 200,20 C240,100 250,180 250,180 Z" class="svg-area-fill" />
                        <path d="M150,180 L150,100 C160,100 200,20 200,20 L200,180 Z" fill="#a5b4fc" opacity="0.3"/>
                        <path d="M200,180 L200,20 C240,100 250,100 250,180 Z" fill="#a5b4fc" opacity="0.3"/>


                    </svg>
                </div>
                <p class="mb-4 text-sm text-gray-600 text-center">איור: עקומת ההתפלגות הנורמלית עם חלוקה לאחוזים לפי סטיות תקן.</p>

                <h3 class="text-xl font-semibold mt-6 mb-3 text-indigo-500">ציון תקן (Z-score)</h3>
                <p class="mb-4">כדי להשוות ערכים מהתפלגויות נורמליות שונות (עם ממוצעים וסטיות תקן שונות), או כדי למצוא את ההסתברות המדויקת שערך מסוים יתקבל, משתמשים בציון תקן. ציון התקן (מסומן באות <span dir="ltr">\(Z\)</span>) מודד בכמה סטיות תקן ערך מסוים (<span dir="ltr">\(X\)</span>) רחוק מהממוצע (<span dir="ltr">\(\mu\)</span>).</p>
                <p>הנוסחה לחישוב ציון תקן היא:</p>
                <span class="formula-box" dir="ltr">\( Z = \frac{X - \mu}{\sigma} \)</span>
                <p class="mt-2 mb-4">כאשר:</p>
                <ul class="list-disc list-inside mb-4 space-y-1">
                    <li><span dir="ltr">\(X\)</span> – הערך שאנו בודקים.</li>
                    <li><span dir="ltr">\(\mu\)</span> – ממוצע ההתפלגות.</li>
                    <li><span dir="ltr">\(\sigma\)</span> – סטיית התקן של ההתפלגות.</li>
                </ul>
                <p class="mb-4">לאחר חישוב ציון התקן <span dir="ltr">\(Z\)</span>, ניתן להשתמש בטבלת ההתפלגות הנורמלית הסטנדרטית (טבלת Z, שלרוב מסופקת בבחינות) כדי למצוא את האחוז המצטבר של הנתונים עד לערך <span dir="ltr">\(X\)</span>, או את האחוז הנמצא בתחום מסוים.</p>
                <p class="mb-4">לדוגמה, ציון תקן <span dir="ltr">\(Z=0\)</span> מתאים לממוצע. ציון תקן <span dir="ltr">\(Z=1\)</span> אומר שהערך <span dir="ltr">\(X\)</span> נמצא סטיית תקן אחת מעל הממוצע. ציון תקן <span dir="ltr">\(Z=-2\)</span> אומר שהערך <span dir="ltr">\(X\)</span> נמצא שתי סטיות תקן מתחת לממוצע.</p>

            </section>

            <section id="practiceSection" class="mb-12 p-6 bg-white rounded-lg shadow-lg">
                <h2 class="text-2xl font-semibold mb-6 text-indigo-600 border-b pb-2">מתרגלים</h2>
                <div class="space-y-8">
                    <div class="exercise p-4 border rounded-md bg-gray-50 shadow">
                        <p class="mb-3"><strong>תרגיל 1:</strong> ציוני מבחן מסוים מתפלגים נורמלית עם ממוצע <span dir="ltr">\(\mu = 75\)</span> וסטיית תקן <span dir="ltr">\(\sigma = 5\)</span>. מה אחוז התלמידים שקיבלו ציון בין 70 ל-80?</p>
                        <div class="flex items-center space-x-2 space-x-reverse mb-2">
                            <input type="text" id="ex1Answer" class="border-gray-300 rounded-md shadow-sm p-2 flex-grow focus:ring-indigo-500 focus:border-indigo-500" placeholder="הכנס אחוז (למשל, 68%)">
                            <button onclick="checkExercise('ex1', 'ex1Answer', '68.2%', 'ex1Feedback', 'ex1SolutionBox', '68.2')" class="bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-2 px-4 rounded-md transition duration-150 ease-in-out">בדוק</button>
                        </div>
                        <div id="ex1Feedback" class="mt-2 text-sm min-h-[20px]"></div>
                        <button onclick="toggleSolution('ex1SolutionBox')" class="mt-2 text-sm text-indigo-500 hover:underline">הצג/הסתר פתרון מלא</button>
                        <div id="ex1SolutionBox" class="solution-box hidden mt-2">
                            <p><strong>פתרון מלא לתרגיל 1:</strong></p>
                            <p>1. נמצא את ציוני התקן (<span dir="ltr">\(Z\)</span>) עבור הציונים 70 ו-80.</p>
                            <p>עבור <span dir="ltr">\(X = 70\)</span>:</p>
                            <span class="formula-box" dir="ltr">\( Z_1 = \frac{70 - 75}{5} = \frac{-5}{5} = -1 \)</span>
                            <p>עבור <span dir="ltr">\(X = 80\)</span>:</p>
                            <span class="formula-box" dir="ltr">\( Z_2 = \frac{80 - 75}{5} = \frac{5}{5} = 1 \)</span>
                            <p>2. אנו מחפשים את אחוז התלמידים שציוניהם נמצאים בין <span dir="ltr">\(Z = -1\)</span> ל-<span dir="ltr">\(Z = 1\)</span>.</p>
                            <p>לפי כלל 68-95-99.7, כ-68.2% מהנתונים נמצאים במרחק של עד סטיית תקן אחת מהממוצע (כלומר, בין <span dir="ltr">\(\mu-\sigma\)</span> ל-<span dir="ltr">\(\mu+\sigma\)</span>, שזה בדיוק התחום בין <span dir="ltr">\(Z=-1\)</span> ל-<span dir="ltr">\(Z=1\)</span>).</p>
                            <p>לכן, אחוז התלמידים שקיבלו ציון בין 70 ל-80 הוא כ-<strong>68.2%</strong>.</p>
                        </div>
                    </div>

                    <div class="exercise p-4 border rounded-md bg-gray-50 shadow">
                        <p class="mb-3"><strong>תרגיל 2:</strong> גובהם של גברים בוגרים באוכלוסייה מסוימת מתפלג נורמלית עם ממוצע <span dir="ltr">\(\mu = 175\)</span> ס"מ וסטיית תקן <span dir="ltr">\(\sigma = 7\)</span> ס"מ. מהו ציון התקן של גבר שגובהו 182 ס"מ?</p>
                        <div class="flex items-center space-x-2 space-x-reverse mb-2">
                            <input type="text" id="ex2Answer" class="border-gray-300 rounded-md shadow-sm p-2 flex-grow focus:ring-indigo-500 focus:border-indigo-500" placeholder="הכנס ציון תקן">
                            <button onclick="checkExercise('ex2', 'ex2Answer', '1', 'ex2Feedback', 'ex2SolutionBox')" class="bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-2 px-4 rounded-md transition duration-150 ease-in-out">בדוק</button>
                        </div>
                        <div id="ex2Feedback" class="mt-2 text-sm min-h-[20px]"></div>
                        <button onclick="toggleSolution('ex2SolutionBox')" class="mt-2 text-sm text-indigo-500 hover:underline">הצג/הסתר פתרון מלא</button>
                        <div id="ex2SolutionBox" class="solution-box hidden mt-2">
                            <p><strong>פתרון מלא לתרגיל 2:</strong></p>
                            <p>נתון: <span dir="ltr">\(\mu = 175\)</span> ס"מ, <span dir="ltr">\(\sigma = 7\)</span> ס"מ, <span dir="ltr">\(X = 182\)</span> ס"מ.</p>
                            <p>נשתמש בנוסחה לציון תקן:</p>
                            <span class="formula-box" dir="ltr">\( Z = \frac{X - \mu}{\sigma} \)</span>
                            <p>נציב את הנתונים:</p>
                            <span class="formula-box" dir="ltr">\( Z = \frac{182 - 175}{7} = \frac{7}{7} = 1 \)</span>
                            <p>ציון התקן של גבר שגובהו 182 ס"מ הוא <strong>1</strong>. כלומר, גובהו הוא סטיית תקן אחת מעל הממוצע.</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="testYourselfSection" class="mb-12 p-6 bg-white rounded-lg shadow-lg">
                <h2 class="text-2xl font-semibold mb-6 text-indigo-600 border-b pb-2">בחן את עצמך</h2>
                <form id="quizForm" class="space-y-6">
                    <div class="quiz-question p-4 border rounded-md bg-gray-50 shadow">
                        <p class="mb-2"><strong>שאלה 1:</strong> בהתפלגות נורמלית, איזה אחוז מהאוכלוסייה נמצא בקירוב בין הממוצע (<span dir="ltr">\(\mu\)</span>) לבין <span dir="ltr">\(\mu + \sigma\)</span>?</p>
                        <div class="space-y-1">
                            <label class="inline-flex items-center">
                                <input type="radio" name="q1" value="13.5" class="form-radio text-indigo-600 focus:ring-indigo-500">
                                <span class="mr-2">13.5%</span>
                            </label><br>
                            <label class="inline-flex items-center">
                                <input type="radio" name="q1" value="34.1" class="form-radio text-indigo-600 focus:ring-indigo-500">
                                <span class="mr-2">34.1%</span>
                            </label><br>
                            <label class="inline-flex items-center">
                                <input type="radio" name="q1" value="68.2" class="form-radio text-indigo-600 focus:ring-indigo-500">
                                <span class="mr-2">68.2%</span>
                            </label><br>
                             <label class="inline-flex items-center">
                                <input type="radio" name="q1" value="95.4" class="form-radio text-indigo-600 focus:ring-indigo-500">
                                <span class="mr-2">95.4%</span>
                            </label>
                        </div>
                    </div>
                    <div class="quiz-question p-4 border rounded-md bg-gray-50 shadow">
                        <p class="mb-2"><strong>שאלה 2:</strong> אם הממוצע של ציונים הוא 80 וסטיית התקן היא 10, מהו ציון התקן של תלמיד שקיבל 70?</p>
                         <div class="space-y-1">
                            <label class="inline-flex items-center">
                                <input type="radio" name="q2" value="-2" class="form-radio text-indigo-600 focus:ring-indigo-500">
                                <span class="mr-2">-2</span>
                            </label><br>
                            <label class="inline-flex items-center">
                                <input type="radio" name="q2" value="-1" class="form-radio text-indigo-600 focus:ring-indigo-500">
                                <span class="mr-2">-1</span>
                            </label><br>
                            <label class="inline-flex items-center">
                                <input type="radio" name="q2" value="0" class="form-radio text-indigo-600 focus:ring-indigo-500">
                                <span class="mr-2">0</span>
                            </label><br>
                             <label class="inline-flex items-center">
                                <input type="radio" name="q2" value="1" class="form-radio text-indigo-600 focus:ring-indigo-500">
                                <span class="mr-2">1</span>
                            </label>
                        </div>
                    </div>

                    <button type="button" onclick="submitQuiz()" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-md transition duration-150 ease-in-out">הגש בוחן</button>
                </form>
                <div id="quizResult" class="mt-4 text-lg min-h-[28px]"></div>
            </section>

            <section id="progressSection" class="text-center p-6 bg-white rounded-lg shadow-lg">
                <button id="markCompletedBtn" onclick="markLessonAsCompleted()" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg text-lg transition duration-150 ease-in-out">
                    סמן שיעור כהושלם
                </button>
                <p id="completionStatus" class="mt-3 text-sm text-gray-600 min-h-[20px]"></p>
            </section>
        </main>

        <footer class="mt-12 text-center text-sm text-gray-500 py-4 border-t border-gray-200">
            <p>&copy; <span id="currentYear"></span> פלטפורמת למידה במתמטיקה. כל הזכויות שמורות.</p>
        </footer>
    </div>

    <script>
        // Function to get lesson ID (hardcoded for this specific lesson page)
        function getLessonId() {
            return 'lesson_35381_normal_distribution';
        }

        // Function to mark lesson as completed
        function markLessonAsCompleted() {
            const lessonId = getLessonId();
            try {
                localStorage.setItem('lessonCompleted_' + lessonId, 'true');
                const statusEl = document.getElementById('completionStatus');
                const buttonEl = document.getElementById('markCompletedBtn');
                if (statusEl) statusEl.textContent = 'השיעור סומן כהושלם!';
                if (statusEl) statusEl.className = 'mt-3 text-sm feedback-correct';
                if (buttonEl) {
                    buttonEl.disabled = true;
                    buttonEl.classList.remove('bg-blue-500', 'hover:bg-blue-600');
                    buttonEl.classList.add('bg-gray-400', 'cursor-not-allowed', 'opacity-75');
                }
                console.log('Lesson ' + lessonId + ' marked as completed.');
            } catch (e) {
                console.error('Error saving to localStorage:', e);
                const statusEl = document.getElementById('completionStatus');
                if (statusEl) statusEl.textContent = 'שגיאה בשמירת ההתקדמות. ודא ש-localStorage מאופשר.';
                if (statusEl) statusEl.className = 'mt-3 text-sm feedback-incorrect';
            }
        }

        // Function to record quiz score
        function recordQuizScore(score, totalQuestions) {
            const lessonId = getLessonId();
            try {
                localStorage.setItem('quizScore_' + lessonId, JSON.stringify({ score: score, total: totalQuestions, date: new Date().toISOString() }));
                console.log('Quiz score for ' + lessonId + ' recorded: ' + score + '/' + totalQuestions);
            } catch (e) {
                console.error('Error saving quiz score to localStorage:', e);
            }
        }

        // Function to check lesson status on load
        function checkLessonStatus() {
            const lessonId = getLessonId();
            try {
                const isCompleted = localStorage.getItem('lessonCompleted_' + lessonId);
                const statusEl = document.getElementById('completionStatus');
                const buttonEl = document.getElementById('markCompletedBtn');

                if (isCompleted === 'true') {
                    if (statusEl) statusEl.textContent = 'שיעור זה הושלם בעבר.';
                    if (statusEl) statusEl.className = 'mt-3 text-sm feedback-correct';
                    if (buttonEl) {
                        buttonEl.disabled = true;
                        buttonEl.classList.remove('bg-blue-500', 'hover:bg-blue-600');
                        buttonEl.classList.add('bg-gray-400', 'cursor-not-allowed', 'opacity-75');
                    }
                } else {
                    if (statusEl) statusEl.textContent = 'עדיין לא סימנת שיעור זה כהושלם.';
                    if (statusEl) statusEl.className = 'mt-3 text-sm text-gray-600';
                }
            } catch (e) {
                console.error('Error reading from localStorage:', e);
            }
        }

        // Interactive exercise checking
        function checkExercise(exerciseId, answerId, correctAnswer, feedbackId, solutionBoxId, correctAnswerAlt) {
            const userAnswer = document.getElementById(answerId).value.trim().replace('%',''); // Remove % for comparison if present
            const feedbackEl = document.getElementById(feedbackId);
            const correctAnswerClean = correctAnswer.replace('%','');
            const correctAnswerAltClean = correctAnswerAlt ? correctAnswerAlt.replace('%','') : null;

            if (userAnswer === correctAnswerClean || (correctAnswerAltClean && userAnswer === correctAnswerAltClean) || userAnswer === correctAnswer || userAnswer === correctAnswerAlt ) {
                feedbackEl.textContent = 'נכון מאוד!';
                feedbackEl.className = 'mt-2 text-sm feedback-correct';
            } else {
                feedbackEl.textContent = 'תשובה לא נכונה. נסה שוב או הצג את הפתרון.';
                feedbackEl.className = 'mt-2 text-sm feedback-incorrect';
            }
        }

        // Toggle solution visibility
        function toggleSolution(solutionBoxId) {
            const solutionBox = document.getElementById(solutionBoxId);
            solutionBox.classList.toggle('hidden');
        }

        // Quiz submission
        function submitQuiz() {
            const quizForm = document.getElementById('quizForm');
            const resultEl = document.getElementById('quizResult');
            let score = 0;
            const totalQuestions = 2; // Updated for two questions

            // Correct answers
            const correctAnswers = {
                q1: '34.1',
                q2: '-1'
            };

            // Check Q1
            const q1Answer = quizForm.elements['q1'].value;
            if (q1Answer === correctAnswers.q1) {
                score++;
            }
             // Check Q2
            const q2Answer = quizForm.elements['q2'].value;
            if (q2Answer === correctAnswers.q2) {
                score++;
            }

            resultEl.textContent = 'הציון שלך הוא: ' + score + ' מתוך ' + totalQuestions;
            if (score === totalQuestions) {
                resultEl.className = 'mt-4 feedback-correct text-lg';
            } else if (score > 0) {
                 resultEl.className = 'mt-4 text-yellow-600 font-semibold text-lg'; // Partially correct
            }
            else {
                resultEl.className = 'mt-4 feedback-incorrect text-lg';
            }
            recordQuizScore(score, totalQuestions);
        }
        
        // Set current year in footer
        document.getElementById('currentYear').textContent = new Date().getFullYear();

        // KaTeX auto-render
        document.addEventListener("DOMContentLoaded", function() {
            renderMathInElement(document.body, {
                delimiters: [
                    {left: "\\(", right: "\\)", display: false},
                    {left: "\\[", right: "\\]", display: true},
                    {left: "$$", right: "$$", display: true}, 
                    {left: "$", right: "$", display: false}    
                ],
                throwOnError: false
            });
            
            checkLessonStatus();
        });
    </script>
</body>
</html>
